import{_ as t,c as o,b as a,d as s,e as n,a as r,f as i,r as p,o as c}from"./app-DPxWUXgB.js";const d={};function u(m,e){const l=p("RouteLink");return c(),o("div",null,[e[10]||(e[10]=a(`<h1 id="continuous-query-cq" tabindex="-1"><a class="header-anchor" href="#continuous-query-cq"><span>Continuous Query, CQ</span></a></h1><p>We can create, drop a CQ, and query all registered CQ configuration information through SQL statements.</p><p>Note that the current distributed version of IoTDB does not support continuous queries. Please stay tuned.</p><h2 id="sql-statements" tabindex="-1"><a class="header-anchor" href="#sql-statements"><span>SQL statements</span></a></h2><h3 id="create-cq" tabindex="-1"><a class="header-anchor" href="#create-cq"><span>Create CQ</span></a></h3><h4 id="syntax" tabindex="-1"><a class="header-anchor" href="#syntax"><span>Syntax</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> (CONTINUOUS QUERY | CQ) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">cq_id</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;">[RESAMPLE EVERY &lt;every_interval&gt; FOR &lt;for_interval&gt;]</span></span>
<span class="line"><span style="color:#C678DD;">BEGIN</span></span>
<span class="line"><span style="color:#C678DD;">SELECT</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#C678DD;">function</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">path_suffix</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">) </span><span style="color:#C678DD;">INTO</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">full_path</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> | </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">node_name</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">path_prefix</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">GROUP BY</span><span style="color:#C678DD;"> time</span><span style="color:#ABB2BF;">(</span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">group_by_interval</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;">) </span><span style="color:#E06C75;">[, level = &lt;level&gt;]</span></span>
<span class="line"><span style="color:#C678DD;">END</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7)),s("ul",null,[e[9]||(e[9]=a("<li><p><code>&lt;cq_id&gt;</code> specifies the globally unique id of CQ.</p></li><li><p><code>&lt;every_interval&gt;</code> specifies the query execution time interval. We currently support the units of ns, us, ms, s, m, h, d, w, and its value should not be lower than the minimum threshold configured by the user.</p></li><li><p><code>&lt;for_interval&gt;</code> specifies the time range of each query as <code>[now()-&lt;for_interval&gt;, now())</code>. We currently support the units of ns, us, ms, s, m, h, d, w.</p></li><li><p><code>&lt;execution_boundary_time&gt;</code> is a date that represents <strong>the start time of the first window</strong>.</p><ul><li><code>&lt;execution_boundary_time&gt;</code> can be earlier than, equals to, later than <strong>current time</strong>.</li><li>This parameter is optional. If not specified, it is equivalent to <code>BOUNDARY now()</code>.</li><li><strong>The end time of the first window</strong> is <code>&lt;execution_boundary_time&gt; + &lt;for_interval&gt;</code>.</li><li>The <strong>start time</strong> of the <code>i (1 &lt;= i)</code>th window is <code>&lt;execution_boundary_time&gt; + &lt;for_interval&gt; + (i - 1) * &lt;every_interval&gt;</code>.</li><li>The <strong>end time</strong> of the <code>i (1 &lt;= i)</code>th window is<code>&lt;execution_boundary_time&gt; + &lt;for_interval&gt; + i * &lt;every_interval&gt;</code>.</li><li>If <strong>current time</strong> is earlier than or equal to <strong>the end time of the first window</strong>, then the first execution moment of the continuous query is <strong>the end time of the first window</strong>.</li><li>If <strong>current time</strong> is later than <strong>the end time of the first window</strong>, then the first execution moment of the continuous query is the <strong>end time of the first window whose end time is later than or equal to the current time</strong> .</li><li>The <strong>query time range</strong> at each execution moment is <code>[now() - &lt;for_interval&gt;, now())</code>.</li></ul></li><li><p><code>&lt;function&gt;</code> specifies the aggregate function.</p></li><li><p><code>&lt;path_prefix&gt;</code> and <code>&lt;path_suffix&gt;</code> are spliced into the queried time series path.</p></li><li><p><code>&lt;full_path&gt;</code> or <code>&lt;node_name&gt;</code> specifies the result time series path.</p></li><li><p><code>&lt;group_by_interval&gt;</code> specifies the time grouping length. We currently support the units of ns, us, ms, s, m, h, d, w, mo, y.</p></li>",8)),s("li",null,[s("p",null,[e[1]||(e[1]=s("code",null,"<level>",-1)),e[2]||(e[2]=n(" refers to grouping according to the ")),e[3]||(e[3]=s("code",null,"<level>",-1)),e[4]||(e[4]=n(" level of the time series, and grouping the aggregation result of time series with the same name below the ")),e[5]||(e[5]=s("code",null,"<level>",-1)),e[6]||(e[6]=n(" level. For the specific semantics of the Group By Level statement and the definition of ")),e[7]||(e[7]=s("code",null,"<level>",-1)),e[8]||(e[8]=n(", see ")),r(l,{to:"/UserGuide/V0.13.x/Write-And-Delete-Data/Delete-Data.html"},{default:i(()=>e[0]||(e[0]=[n("aggregation-by-level")])),_:1})])])]),e[11]||(e[11]=a(`<p>Note:</p><ul><li><code>&lt;for_interval&gt;</code>,<code>&lt;every_interval&gt;</code> can optionally be specified. If the user does not specify one of them, the value of the unspecified item will be processed equal to <code>&lt;group_by_interval&gt;</code>. <ul><li>The values of <code>&lt;every_interval&gt;</code>, <code>&lt;for_interval&gt;</code> and <code>&lt;group_by_interval&gt;</code> should all be greater than 0.</li><li>The value of <code>&lt;group_by_interval&gt;</code> should be less than the value of <code>&lt;for_interval&gt;</code>, otherwise the system will process the value equal to <code>&lt;for_interval&gt;</code>.</li><li>The user should specify the appropriate <code>&lt;for_interval&gt;</code> and <code>&lt;every_interval&gt;</code> according to actual needs. <ul><li>If <code>&lt;for_interval&gt;</code> is greater than <code>&lt;every_interval&gt;</code>, there will be partial data overlap in each query window. This configuration is not recommended from the perspective of query performance.</li><li>If <code>&lt;for_interval&gt;</code> is less than <code>&lt;every_interval&gt;</code>, there may be uncovered data between each query window.</li></ul></li></ul></li><li>For the result series path <ul><li>The user can choose to specify <code>&lt;full_path&gt;</code>, which is the complete time series path starting with <code>root</code>. The user can use the <code>\${x}</code> variable in the path to represent the node name of <code>level = x</code> in the original time series. <code>x</code> should be greater than or equal to 0 and less than or equal to the value of <code>&lt;level&gt;</code><br> (If <code>level</code> is not specified, it should be less than or equal to the level, i.e. length, of <code>&lt;path_prefix&gt;</code>).</li><li>The user can also specify only <code>&lt;node_name&gt;</code>, which is the last node name of the result time series path. <ul><li>If the user specifies <code>&lt;level&gt; = l</code>, the result time series path generated by the system is <code>root.\${1}. ... .\${l}.&lt;node_name&gt;</code></li><li>If the user does not specify <code>&lt;level&gt;</code>, let the maximum level of the original time series be <code>L</code>,<br> Then the result time series path generated by the system is <code>root.\${1}. ... .\${L-1}.&lt;node_name&gt;</code>.</li></ul></li></ul></li></ul><h4 id="examples" tabindex="-1"><a class="header-anchor" href="#examples"><span>Examples</span></a></h4><h5 id="original-data" tabindex="-1"><a class="header-anchor" href="#original-data"><span>Original Data</span></a></h5><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|                   timeseries|alias|storage group|dataType|encoding|compression|tags|attributes|</span></span>
<span class="line"><span>+-----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|root.ln.wf02.wt02.temperature| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf02.wt01.temperature| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf01.wt02.temperature| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf01.wt01.temperature| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>+-----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+-----------------------------+-----------------------------+-----------------------------+-----------------------------+</span></span>
<span class="line"><span>|                         Time|root.ln.wf02.wt02.temperature|root.ln.wf02.wt01.temperature|root.ln.wf01.wt02.temperature|root.ln.wf01.wt01.temperature|</span></span>
<span class="line"><span>+-----------------------------+-----------------------------+-----------------------------+-----------------------------+-----------------------------+</span></span>
<span class="line"><span>|2021-05-11T22:18:14.598+08:00|                        121.0|                         72.0|                        183.0|                        115.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:19.941+08:00|                          0.0|                         68.0|                         68.0|                        103.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:24.949+08:00|                        122.0|                         45.0|                         11.0|                         14.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:29.967+08:00|                         47.0|                         14.0|                         59.0|                        181.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:34.979+08:00|                        182.0|                        113.0|                         29.0|                        180.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:39.990+08:00|                         42.0|                         11.0|                         52.0|                         19.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:44.995+08:00|                         78.0|                         38.0|                        123.0|                         52.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:49.999+08:00|                        137.0|                        172.0|                        135.0|                        193.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:55.003+08:00|                         16.0|                        124.0|                        183.0|                         18.0|</span></span>
<span class="line"><span>+-----------------------------+-----------------------------+-----------------------------+-----------------------------+-----------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="result-time-series-path-configuration-example" tabindex="-1"><a class="header-anchor" href="#result-time-series-path-configuration-example"><span>Result time series path configuration example</span></a></h5><p>For the above original time series, if the user specifies that the query aggregation level is <code>2</code>, the aggregation function is <code>avg</code>,<br> The user can specify only the last node name of the generated time series in the <code>INTO</code> clause. If the user specifies it as <code>temperature_avg</code>, the full path generated by the system will be <code>root.\${1}.\${2}.temperature_avg</code> .<br> The user can also specify the full path in the <code>INTO</code> clause, and the user can specify it as <code>root.\${1}.\${2}.temperature_avg</code>, <code>root.ln_cq.\${2}.temperature_avg</code>, <code>root.\${1}_cq.\${2}.temperature_avg</code>, <code>root.\${1}.\${2}_cq.temperature_avg</code> etc.,<br> It can also be specified as <code>root.\${2}.\${1}.temperature_avg</code> and others as needed.<br> It should be noted that the <code>x</code> in <code>\${x}</code> should be greater than or equal to <code>1</code> and less than or equal to the value of <code>&lt;level&gt;</code><br> (If <code>&lt;level&gt;</code> is not specified, it should be less than or equal to the length of <code>&lt;path_prefix&gt;</code>). In the above example, <code>x</code> should be less than or equal to <code>2</code>.</p><h5 id="create-cq1" tabindex="-1"><a class="header-anchor" href="#create-cq1"><span>Create <code>cq1</code></span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> CONTINUOUS QUERY cq1 </span></span>
<span class="line"><span style="color:#C678DD;">BEGIN</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">  SELECT</span><span style="color:#ABB2BF;"> max_value(temperature) </span></span>
<span class="line"><span style="color:#C678DD;">  INTO</span><span style="color:#ABB2BF;"> temperature_max </span></span>
<span class="line"><span style="color:#C678DD;">  FROM</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.*.* </span></span>
<span class="line"><span style="color:#C678DD;">  GROUP BY</span><span style="color:#C678DD;"> time</span><span style="color:#ABB2BF;">(10s) </span></span>
<span class="line"><span style="color:#C678DD;">END</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Query the maximum value of <code>root.ln.*.*.temperature</code> in the previous 10s every 10s (the results are grouped by 10s),<br> and the results will be written to <code>root.\${1}.\${2}.\${3}.temperature_max</code>,<br> As a result, 4 new time series will be generated.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+---------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|                       timeseries|alias|storage group|dataType|encoding|compression|tags|attributes|</span></span>
<span class="line"><span>+---------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|root.ln.wf02.wt02.temperature_max| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf02.wt01.temperature_max| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf01.wt02.temperature_max| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf01.wt01.temperature_max| null|      root.ln|   FLOAT| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>+---------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+---------------------------------+---------------------------------+---------------------------------+---------------------------------+</span></span>
<span class="line"><span>|                         Time|root.ln.wf02.wt02.temperature_max|root.ln.wf02.wt01.temperature_max|root.ln.wf01.wt02.temperature_max|root.ln.wf01.wt01.temperature_max|</span></span>
<span class="line"><span>+-----------------------------+---------------------------------+---------------------------------+---------------------------------+---------------------------------+</span></span>
<span class="line"><span>|2021-05-11T22:18:16.964+08:00|                            122.0|                             68.0|                             68.0|                            103.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:26.964+08:00|                            182.0|                            113.0|                             59.0|                            181.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:36.964+08:00|                             78.0|                             38.0|                            123.0|                             52.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:46.964+08:00|                            137.0|                            172.0|                            183.0|                            193.0|</span></span>
<span class="line"><span>+-----------------------------+---------------------------------+---------------------------------+---------------------------------+---------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="create-cq2" tabindex="-1"><a class="header-anchor" href="#create-cq2"><span>Create <code>cq2</code></span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> CONTINUOUS QUERY cq2 </span></span>
<span class="line"><span style="color:#C678DD;">RESAMPLE</span><span style="color:#ABB2BF;"> EVERY 20s </span><span style="color:#C678DD;">FOR</span><span style="color:#ABB2BF;"> 20s </span></span>
<span class="line"><span style="color:#C678DD;">BEGIN</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">  SELECT</span><span style="color:#56B6C2;"> avg</span><span style="color:#ABB2BF;">(temperature) </span></span>
<span class="line"><span style="color:#C678DD;">  INTO</span><span style="color:#ABB2BF;"> temperature_avg </span></span>
<span class="line"><span style="color:#C678DD;">  FROM</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.*.* </span></span>
<span class="line"><span style="color:#C678DD;">  GROUP BY</span><span style="color:#C678DD;"> time</span><span style="color:#ABB2BF;">(10s), </span><span style="color:#C678DD;">level</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">END</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Query the average value of <code>root.ln.*.*.temperature</code> in the previous 20s every 20s (the results are grouped by 10s),<br> and the results will be written to <code>root.\${1}.\${2}.temperature_avg</code>,<br> As a result, 2 new time series will be generated.<br> Among them, <code>root.ln.wf02.temperature_avg</code> is generated by the aggregation calculation of <code>root.ln.wf02.wt02.temperature</code> and <code>root.ln.wf02.wt01.temperature</code>,<br> and <code>root.ln.wf01.temperature_avg</code> is generated by the aggregation calculation of <code>root.ln.wf01.wt02.temperature</code> and <code>root.ln.wf01.wt01.temperature</code>.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|                  timeseries|alias|storage group|dataType|encoding|compression|tags|attributes|</span></span>
<span class="line"><span>+----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|root.ln.wf02.temperature_avg| null|      root.ln|  DOUBLE| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln.wf01.temperature_avg| null|      root.ln|  DOUBLE| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>+----------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+----------------------------+----------------------------+</span></span>
<span class="line"><span>|                         Time|root.ln.wf02.temperature_avg|root.ln.wf01.temperature_avg|</span></span>
<span class="line"><span>+-----------------------------+----------------------------+----------------------------+</span></span>
<span class="line"><span>|2021-05-11T22:18:16.969+08:00|                       58.75|                        49.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:26.969+08:00|                        89.0|                      112.25|</span></span>
<span class="line"><span>|2021-05-11T22:18:36.969+08:00|                       42.25|                        61.5|</span></span>
<span class="line"><span>|2021-05-11T22:18:46.969+08:00|                      112.25|                      132.25|</span></span>
<span class="line"><span>+-----------------------------+----------------------------+----------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="create-cq3" tabindex="-1"><a class="header-anchor" href="#create-cq3"><span>Create <code>cq3</code></span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> CONTINUOUS QUERY cq3 </span></span>
<span class="line"><span style="color:#C678DD;">RESAMPLE</span><span style="color:#ABB2BF;"> EVERY 20s </span><span style="color:#C678DD;">FOR</span><span style="color:#ABB2BF;"> 20s </span></span>
<span class="line"><span style="color:#C678DD;">BEGIN</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">  SELECT</span><span style="color:#56B6C2;"> avg</span><span style="color:#ABB2BF;">(temperature) </span></span>
<span class="line"><span style="color:#C678DD;">  INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln_cq</span><span style="color:#ABB2BF;">.\${</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">}.temperature_avg </span></span>
<span class="line"><span style="color:#C678DD;">  FROM</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.*.* </span></span>
<span class="line"><span style="color:#C678DD;">  GROUP BY</span><span style="color:#C678DD;"> time</span><span style="color:#ABB2BF;">(10s), </span><span style="color:#C678DD;">level</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">END</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The query mode is the same as <code>cq2</code>,<br> and the results will be written to <code>root.ln_cq.\${2}.temperature_avg</code>.<br> As a result, 2 new time series will be generated.<br> Among them, <code>root.ln_cq.wf02.temperature_avg</code> is generated by the aggregation calculation of <code>root.ln.wf02.wt02.temperature</code> and <code>root.ln.wf02.wt01.temperature</code>,<br> and <code>root.ln_cq.wf01.temperature_avg</code> is generated by the aggregation calculation of <code>root.ln.wf01.wt02.temperature</code> and <code>root.ln.wf01.wt01.temperature</code>.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|                     timeseries|alias|storage group|dataType|encoding|compression|tags|attributes|</span></span>
<span class="line"><span>+-------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span>
<span class="line"><span>|root.ln_cq.wf02.temperature_avg| null|   root.ln_cq|  DOUBLE| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>|root.ln_cq.wf01.temperature_avg| null|   root.ln_cq|  DOUBLE| GORILLA|     SNAPPY|null|      null|</span></span>
<span class="line"><span>+-------------------------------+-----+-------------+--------+--------+-----------+----+----------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+-------------------------------+-------------------------------+</span></span>
<span class="line"><span>|                         Time|root.ln_cq.wf02.temperature_avg|root.ln_cq.wf01.temperature_avg|</span></span>
<span class="line"><span>+-----------------------------+-------------------------------+-------------------------------+</span></span>
<span class="line"><span>|2021-05-11T22:18:16.971+08:00|                          58.75|                           49.0|</span></span>
<span class="line"><span>|2021-05-11T22:18:26.971+08:00|                           89.0|                         112.25|</span></span>
<span class="line"><span>|2021-05-11T22:18:36.971+08:00|                          42.25|                           61.5|</span></span>
<span class="line"><span>|2021-05-11T22:18:46.971+08:00|                         112.25|                         132.25|</span></span>
<span class="line"><span>+-----------------------------+-------------------------------+-------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建-cq4" tabindex="-1"><a class="header-anchor" href="#创建-cq4"><span>创建 <code>cq4</code></span></a></h5><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">CREATE</span><span style="color:#ABB2BF;"> CONTINUOUS QUERY cq4 </span></span>
<span class="line"><span style="color:#C678DD;">RESAMPLE</span><span style="color:#ABB2BF;"> EVERY 20s </span><span style="color:#C678DD;">FOR</span><span style="color:#ABB2BF;"> 20s BOUNDARY </span><span style="color:#D19A66;">2022</span><span style="color:#ABB2BF;">-</span><span style="color:#D19A66;">01</span><span style="color:#ABB2BF;">-14T23:</span><span style="color:#D19A66;">00</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">00</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">000</span><span style="color:#ABB2BF;">+</span><span style="color:#D19A66;">08</span><span style="color:#ABB2BF;">:</span><span style="color:#D19A66;">00</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">BEGIN</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">  SELECT</span><span style="color:#56B6C2;"> avg</span><span style="color:#ABB2BF;">(temperature) </span></span>
<span class="line"><span style="color:#C678DD;">  INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln_cq</span><span style="color:#ABB2BF;">.\${</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">}.temperature_avg </span></span>
<span class="line"><span style="color:#C678DD;">  FROM</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.*.* </span><span style="color:#C678DD;">GROUP BY</span><span style="color:#C678DD;"> time</span><span style="color:#ABB2BF;">(10s), </span><span style="color:#C678DD;">level</span><span style="color:#56B6C2;">=</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">END</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This example is almost identical to creating cq3. The difference is that in this example the user specified <code>BOUNDARY 2022-01-14T23:00:00.000+08:00 </code>.</p><p>Note that the first execution time of this CQ is later than the time in the example, so <code>2022-01-14T23:00:20.000+08:00</code> is the first execution time. Recursively, <code>2022-01-14T23:00:40.000+08:00</code> is the second execution moment, <code>2022-01-14T23:01:00.000+08:00</code> is the third execution moment...</p><p>The SQL statement executed at the first execution moment is <code>select avg(temperature) from root.ln.*.* group by ([2022-01-14T23:00:00.000+08:00, 2022-01-14T23:00: 20.000+08:00), 10s), level = 2</code>.</p><p>The SQL statement executed at the second execution moment is <code>select avg(temperature) from root.ln.*.* group by ([2022-01-14T23:00:20.000+08:00, 2022-01-14T23:00: 40.000+08:00), 10s), level = 2</code>.</p><p>The SQL statement executed at the third execution moment is <code>select avg(temperature) from root.ln.*.* group by ([2022-01-14T23:00:40.000+08:00, 2022-01-14T23:01: 00.000+08:00), 10s), level = 2</code>.</p><p>...</p><h3 id="show-cq-information" tabindex="-1"><a class="header-anchor" href="#show-cq-information"><span>Show CQ Information</span></a></h3><h4 id="syntax-1" tabindex="-1"><a class="header-anchor" href="#syntax-1"><span>Syntax</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">SHOW (CONTINUOUS QUERIES | CQS)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="example-result" tabindex="-1"><a class="header-anchor" href="#example-result"><span>Example Result</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-------+--------------+------------+-------------+----------------------------------------------------------------------------------------+-----------------------------------+</span></span>
<span class="line"><span>|cq name|every interval|for interval|     boundary|                                                                               query sql|                        target path|</span></span>
<span class="line"><span>+-------+--------------+------------+-------------+----------------------------------------------------------------------------------------+-----------------------------------+</span></span>
<span class="line"><span>|    cq1|         10000|       10000|1642166102238|     select max_value(temperature) from root.ln.*.* group by ([now() - 10s, now()), 10s)|root.\${1}.\${2}.\${3}.temperature_max|</span></span>
<span class="line"><span>|    cq3|         20000|       20000|1642166118339|select avg(temperature) from root.ln.*.* group by ([now() - 20s, now()), 10s), level = 2|    root.ln_cq.\${2}.temperature_avg|</span></span>
<span class="line"><span>|    cq2|         20000|       20000|1642166111493|select avg(temperature) from root.ln.*.* group by ([now() - 20s, now()), 10s), level = 2|     root.\${1}.\${2}.temperature_avg|</span></span>
<span class="line"><span>|    cq4|         20000|       20000|1642172400000|select avg(temperature) from root.ln.*.* group by ([now() - 20s, now()), 10s), level = 2|    root.ln_cq.\${2}.temperature_avg|</span></span>
<span class="line"><span>+-------+--------------+------------+-------------+----------------------------------------------------------------------------------------+-----------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="drop-cq" tabindex="-1"><a class="header-anchor" href="#drop-cq"><span>Drop CQ</span></a></h3><h4 id="syntax-2" tabindex="-1"><a class="header-anchor" href="#syntax-2"><span>Syntax</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">DROP</span><span style="color:#ABB2BF;"> (CONTINUOUS QUERY | CQ) </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">cq_id</span><span style="color:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="example" tabindex="-1"><a class="header-anchor" href="#example"><span>Example</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">DROP</span><span style="color:#ABB2BF;"> CONTINUOUS QUERY cq3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">DROP</span><span style="color:#ABB2BF;"> CQ cq3</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="system-parameter-configuration" tabindex="-1"><a class="header-anchor" href="#system-parameter-configuration"><span>System Parameter Configuration</span></a></h2><table><thead><tr><th style="text-align:left;">Name</th><th>Description</th><th>Data Type</th><th>Default Value</th></tr></thead><tbody><tr><td style="text-align:left;"><code>continuous_query_execution_thread</code></td><td>The number of threads in the thread pool that executes continuous query tasks</td><td>int</td><td>max(1, CPU core number / 2)</td></tr><tr><td style="text-align:left;"><code>max_pending_continuous_query_tasks</code></td><td>The maximum number of continuous query tasks pending in queue</td><td>int</td><td>64</td></tr><tr><td style="text-align:left;"><code>continuous_query_min_every_interval</code></td><td>The minimum value of the continuous query execution time interval</td><td>duration</td><td>1s</td></tr></tbody></table>`,44))])}const h=t(d,[["render",u],["__file","Continuous-Query.html.vue"]]),g=JSON.parse('{"path":"/UserGuide/V0.13.x/Process-Data/Continuous-Query.html","title":"Continuous Query, CQ","lang":"en-US","frontmatter":{"description":"Continuous Query, CQ We can create, drop a CQ, and query all registered CQ configuration information through SQL statements. Note that the current distributed version of IoTDB d...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://iotdb.apache.org/zh/UserGuide/V0.13.x/Process-Data/Continuous-Query.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/UserGuide/V0.13.x/Process-Data/Continuous-Query.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:title","content":"Continuous Query, CQ"}],["meta",{"property":"og:description","content":"Continuous Query, CQ We can create, drop a CQ, and query all registered CQ configuration information through SQL statements. Note that the current distributed version of IoTDB d..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-07-10T03:11:17.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-10T03:11:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Continuous Query, CQ\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-07-10T03:11:17.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"SQL statements","slug":"sql-statements","link":"#sql-statements","children":[{"level":3,"title":"Create CQ","slug":"create-cq","link":"#create-cq","children":[]},{"level":3,"title":"Show CQ Information","slug":"show-cq-information","link":"#show-cq-information","children":[]},{"level":3,"title":"Drop CQ","slug":"drop-cq","link":"#drop-cq","children":[]}]},{"level":2,"title":"System Parameter Configuration","slug":"system-parameter-configuration","link":"#system-parameter-configuration","children":[]}],"git":{"createdTime":1688958677000,"updatedTime":1688958677000,"contributors":[{"name":"CritasWang","username":"CritasWang","email":"critas@outlook.com","commits":1,"url":"https://github.com/CritasWang"}]},"readingTime":{"minutes":6.74,"words":2021},"filePathRelative":"UserGuide/V0.13.x/Process-Data/Continuous-Query.md","localizedDate":"July 10, 2023","autoDesc":true}');export{h as comp,g as data};
