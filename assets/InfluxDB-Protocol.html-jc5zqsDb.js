import{_ as s,c as a,b as n,o}from"./app-cBTVd9fo.js";const t={};function l(r,e){return o(),a("div",null,e[0]||(e[0]=[n(`<h2 id="_0-import-dependency" tabindex="-1"><a class="header-anchor" href="#_0-import-dependency"><span>0. Import Dependency</span></a></h2><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.apache.iotdb&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;influxdb-protocol&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">        &lt;</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;1.0.0&lt;/</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;/</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here are some <a href="https://github.com/apache/iotdb/tree/master/example/inflxudb-protocol-example/src/main/java/org/apache/iotdb/influxdb/InfluxDBExample.java" target="_blank" rel="noopener noreferrer">examples</a> of connecting IoTDB using the InfluxDB-Protocol adapter.</p><h2 id="_1-switching-scheme" tabindex="-1"><a class="header-anchor" href="#_1-switching-scheme"><span>1. Switching Scheme</span></a></h2><p>If your original service code for accessing InfluxDB is as follows:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E5C07B;">InfluxDB</span><span style="color:#E06C75;"> influxDB </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> InfluxDBFactory</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(openurl, username, password);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>You only need to replace the InfluxDBFactory with <strong>IoTDBInfluxDBFactory</strong> to switch the business to IoTDB：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E5C07B;">InfluxDB</span><span style="color:#E06C75;"> influxDB </span><span style="color:#56B6C2;">=</span><span style="color:#E5C07B;"> IoTDBInfluxDBFactory</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">connect</span><span style="color:#ABB2BF;">(openurl, username, password);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-conceptual-design" tabindex="-1"><a class="header-anchor" href="#_2-conceptual-design"><span>2. Conceptual Design</span></a></h2><h3 id="_2-1-influxdb-protocol-adapter" tabindex="-1"><a class="header-anchor" href="#_2-1-influxdb-protocol-adapter"><span>2.1 InfluxDB-Protocol Adapter</span></a></h3><p>Based on the IoTDB Java ServiceProvider interface, the adapter implements the &#39;interface InfluxDB&#39; of the java interface of InfluxDB, and provides users with all the interface methods of InfluxDB. End users can use the InfluxDB protocol to initiate write and read requests to IoTDB without perception.</p><figure><img src="https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/architecture-design.png?raw=true" alt="architecture-design" tabindex="0" loading="lazy"><figcaption>architecture-design</figcaption></figure><figure><img src="https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/class-diagram.png?raw=true" alt="class-diagram" tabindex="0" loading="lazy"><figcaption>class-diagram</figcaption></figure><h3 id="_2-2-metadata-format-conversion" tabindex="-1"><a class="header-anchor" href="#_2-2-metadata-format-conversion"><span>2.2 Metadata Format Conversion</span></a></h3><p>The metadata of InfluxDB is tag field model, and the metadata of IoTDB is tree model. In order to make the adapter compatible with the InfluxDB protocol, the metadata model of InfluxDB needs to be transformed into the metadata model of IoTDB.</p><h4 id="_2-2-1-influxdb-metadata" tabindex="-1"><a class="header-anchor" href="#_2-2-1-influxdb-metadata"><span>2.2.1 InfluxDB Metadata</span></a></h4><ol><li>database: database name.</li><li>measurement: measurement name.</li><li>tags: various indexed attributes.</li><li>fields: various record values(attributes without index).</li></ol><figure><img src="https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/influxdb-data.png?raw=true" alt="influxdb-data" tabindex="0" loading="lazy"><figcaption>influxdb-data</figcaption></figure><h4 id="_2-2-2-iotdb-metadata" tabindex="-1"><a class="header-anchor" href="#_2-2-2-iotdb-metadata"><span>2.2.2 IoTDB Metadata</span></a></h4><ol><li>database: database name.</li><li>path(time series ID): storage path.</li><li>measurement: physical quantity.</li></ol><figure><img src="https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/iotdb-data.png?raw=true" alt="iotdb-data" tabindex="0" loading="lazy"><figcaption>iotdb-data</figcaption></figure><h4 id="_2-2-3-mapping-relationship-between-the-two" tabindex="-1"><a class="header-anchor" href="#_2-2-3-mapping-relationship-between-the-two"><span>2.2.3 Mapping relationship between the two</span></a></h4><p>The mapping relationship between InfluxDB metadata and IoTDB metadata is as follows:</p><ol><li>The database and measurement in InfluxDB are combined as the database in IoTDB.</li><li>The field key in InfluxDB is used as the measurement path in IoTDB, and the field value in InfluxDB is the measured point value recorded under the path.</li><li>Tag in InfluxDB is expressed by the path between database and measurement in IoTDB. The tag key of InfluxDB is implicitly expressed by the order of the path between database and measurement, and the tag value is recorded as the name of the path in the corresponding order.</li></ol><p>The transformation relationship from InfluxDB metadata to IoTDB metadata can be represented by the following publicity:</p><p><code>root.{database}.{measurement}.{tag value 1}.{tag value 2}...{tag value N-1}.{tag value N}.{field key}</code></p><figure><img src="https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/influxdb-vs-iotdb-data.png?raw=true" alt="influxdb-vs-iotdb-data" tabindex="0" loading="lazy"><figcaption>influxdb-vs-iotdb-data</figcaption></figure><p>As shown in the figure above, it can be seen that:</p><p>In IoTDB, we use the path between database and measurement to express the concept of InfluxDB tag, which is the part of the green box on the right in the figure.</p><p>Each layer between database and measurement represents a tag. If the number of tag keys is n, the number of layers of the path between database and measurement is n. We sequentially number each layer between database and measurement, and each sequence number corresponds to a tag key one by one. At the same time, we use the <strong>path name</strong> of each layer between database and measurement to remember tag value. Tag key can find the tag value under the corresponding path level through its own serial number.</p><h4 id="_2-2-4-key-problem" tabindex="-1"><a class="header-anchor" href="#_2-2-4-key-problem"><span>2.2.4 Key Problem</span></a></h4><p>In the SQL statement of InfluxDB, the different order of tags does not affect the actual execution .</p><p>For example: <code>insert factory, workshop=A1, production=B1, temperature=16.9</code> and <code>insert factory, production=B1, workshop=A1, temperature=16.9</code> have the same meaning (and execution result) of the two InfluxDB SQL.</p><p>However, in IoTDB, the above inserted data points can be stored in <code>root.monitor.factory.A1.B1.temperature</code> can also be stored in <code>root.monitor.factory.B1.A1.temperature</code>. Therefore, the order of the tags of the InfluxDB stored in the IoTDB path needs special consideration because <code>root.monitor.factory.A1.B1.temperature</code> and</p><p><code>root.monitor.factory.B1.A1.temperature</code> is two different sequences. We can think that iotdb metadata model is &quot;sensitive&quot; to the processing of tag order.</p><p>Based on the above considerations, we also need to record the hierarchical order of each tag in the IoTDB path in the IoTDB, as to ensure that the adapter can only operate on a time series in the IoTDB as long as the SQL expresses operations on the same time series, regardless of the order in which the tags appear in the InfluxDB SQL.</p><p>Another problem that needs to be considered here is how to persist the tag key and corresponding order relationship of InfluxDB into the IoTDB database to ensure that relevant information will not be lost.</p><p><strong>Solution:</strong></p><p><strong>The form of tag key correspondence in memory</strong></p><p>Maintain the order of tags at the IoTDB path level by using the map structure of <code>Map&lt;Measurement,Map&lt;Tag key, order&gt;&gt;</code> in memory.</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E5C07B;">    Map</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;"> Map</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#ABB2BF;">,</span><span style="color:#E06C75;"> Integer</span><span style="color:#56B6C2;">&gt;&gt;</span><span style="color:#E06C75;"> measurementTagOrder</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>It can be seen that map is a two-tier structure.</p><p>The key of the first layer is an InfluxDB measurement of string type, and the value of the first layer is a Map&lt;string,Integer&gt; structure.</p><p>The key of the second layer is the InfluxDB tag key of string type, and the value of the second layer is the tag order of Integer type, that is, the order of tags at the IoTDB path level.</p><p>When in use, you can first locate the tag through the InfluxDB measurement, then locate the tag through the InfluxDB tag key, and finally get the order of tags at the IoTDB path level.</p><p><strong>Persistence scheme of tag key correspondence order</strong></p><p>Database is <code>root.TAG_ Info</code>, using <code>database_name</code>,<code>measurement_ name</code>, <code>tag_ Name </code> and <code>tag_ Order</code> under the database to store tag key and its corresponding order relationship by measuring points.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+---------------------------+------------------------------+----------------------+-----------------------+</span></span>
<span class="line"><span>|                         Time|root.TAG_INFO.database_name|root.TAG_INFO.measurement_name|root.TAG_INFO.tag_name|root.TAG_INFO.tag_order|</span></span>
<span class="line"><span>+-----------------------------+---------------------------+------------------------------+----------------------+-----------------------+</span></span>
<span class="line"><span>|2021-10-12T01:21:26.907+08:00|                    monitor|                       factory|              workshop|                      1|</span></span>
<span class="line"><span>|2021-10-12T01:21:27.310+08:00|                    monitor|                       factory|            production|                      2|</span></span>
<span class="line"><span>|2021-10-12T01:21:27.313+08:00|                    monitor|                       factory|                  cell|                      3|</span></span>
<span class="line"><span>|2021-10-12T01:21:47.314+08:00|                   building|                           cpu|              tempture|                      1|</span></span>
<span class="line"><span>+-----------------------------+---------------------------+------------------------------+----------------------+-----------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-example" tabindex="-1"><a class="header-anchor" href="#_2-3-example"><span>2.3 Example</span></a></h3><h4 id="_2-3-1-insert-records" tabindex="-1"><a class="header-anchor" href="#_2-3-1-insert-records"><span>2.3.1 Insert records</span></a></h4><ol><li><p>Suppose three pieces of data are inserted into the InfluxDB in the following order (database = monitor):</p><p>(1)<code>insert student,name=A,phone=B,sex=C score=99</code></p><p>(2)<code>insert student,address=D score=98</code></p><p>(3)<code>insert student,name=A,phone=B,sex=C,address=D score=97</code></p></li><li><p>Simply explain the timing of the above InfluxDB, and database is monitor; Measurement is student; Tag is name, phone, sex and address respectively; Field is score.</p></li></ol><p>The actual storage of the corresponding InfluxDB is:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>time                address name phone sex socre</span></span>
<span class="line"><span>----                ------- ---- ----- --- -----</span></span>
<span class="line"><span>1633971920128182000         A    B     C   99</span></span>
<span class="line"><span>1633971947112684000 D                      98</span></span>
<span class="line"><span>1633971963011262000 D       A    B     C   97</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><p>The process of inserting three pieces of data in sequence by IoTDB is as follows:</p><p>(1) When inserting the first piece of data, we need to update the three new tag keys to the table. The table of the record tag sequence corresponding to IoTDB is:</p><p>| database | measurement | tag_key | Order |<br> | -------- | ----------- | ------- | ----- |<br> | monitor | student | name | 0 |<br> | monitor | student | phone | 1 |<br> | monitor | student | sex | 2 |</p><p>(2) When inserting the second piece of data, since there are already three tag keys in the table recording the tag order, it is necessary to update the record with the fourth tag key=address. The table of the record tag sequence corresponding to IoTDB is:</p><p>| database | measurement | tag_key | order |<br> | -------- | ----------- | ------- | ----- |<br> | monitor | student | name | 0 |<br> | monitor | student | phone | 1 |<br> | monitor | student | sex | 2 |<br> | monitor | student | address | 3 |</p><p>(3) When inserting the third piece of data, the four tag keys have been recorded at this time, so there is no need to update the record. The table of the record tag sequence corresponding to IoTDB is:</p><p>| database | measurement | tag_key | order |<br> | -------- | ----------- | ------- | ----- |<br> | monitor | student | name | 0 |<br> | monitor | student | phone | 1 |<br> | monitor | student | sex | 2 |<br> | monitor | student | address | 3 |</p></li><li><p>(1) The IoTDB sequence corresponding to the first inserted data is root.monitor.student.A.B.C</p><p>(2) The IoTDB sequence corresponding to the second inserted data is root.monitor.student.PH.PH.PH.D (where PH is a placeholder).</p><p>It should be noted that since the tag key = address of this data appears the fourth, but it does not have the corresponding first three tag values, it needs to be replaced by a PH. The purpose of this is to ensure that the tag order in each data will not be disordered, which is consistent with the order in the current order table, so that the specified tag can be filtered when querying data.</p><p>(3) The IoTDB sequence corresponding to the second inserted data is root.monitor.student.A.B.C.D</p><p>The actual storage of the corresponding IoTDB is:</p></li></ol><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+-----------------------------+--------------------------------+-------------------------------------+----------------------------------+</span></span>
<span class="line"><span>|                         Time|root.monitor.student.A.B.C.score|root.monitor.student.PH.PH.PH.D.score|root.monitor.student.A.B.C.D.score|</span></span>
<span class="line"><span>+-----------------------------+--------------------------------+-------------------------------------+----------------------------------+</span></span>
<span class="line"><span>|2021-10-12T01:21:26.907+08:00|                              99|                                 NULL|                              NULL|</span></span>
<span class="line"><span>|2021-10-12T01:21:27.310+08:00|                            NULL|                                   98|                              NULL|</span></span>
<span class="line"><span>|2021-10-12T01:21:27.313+08:00|                            NULL|                                 NULL|                                97|</span></span>
<span class="line"><span>+-----------------------------+--------------------------------+-------------------------------------+----------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="5"><li>If the insertion order of the above three data is different, we can see that the corresponding actual path has changed, because the order of tags in the InfluxDB data has changed, and the order of the corresponding path nodes in IoTDB has also changed.</li></ol><p>However, this will not affect the correctness of the query, because once the tag order of InfluxDB is determined, the query will also filter the tag values according to the order recorded in this order table. Therefore, the correctness of the query will not be affected.</p><h4 id="_2-3-2-query-data" tabindex="-1"><a class="header-anchor" href="#_2-3-2-query-data"><span>2.3.2 Query Data</span></a></h4><ol><li><p>Query the data of phone = B in student. In database = monitor, measurement = student, the order of tag = phone is 1, and the maximum order is 3. The query corresponding to IoTDB is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student.*.B</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Query the data with phone = B and score &gt; 97 in the student. The query corresponding to IoTDB is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student.*.B </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Query the data of the student with phone = B and score &gt; 97 in the last seven days. The query corresponding to IoTDB is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student.*.B </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span><span style="color:#C678DD;"> and</span><span style="color:#C678DD;"> time</span><span style="color:#56B6C2;"> &gt;</span><span style="color:#C678DD;"> now</span><span style="color:#ABB2BF;">()-7d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>Query the name = a or score &gt; 97 in the student. Since the tag is stored in the path, there is no way to complete the <strong>or</strong> semantic query of tag and field at the same time with one query. Therefore, multiple queries or operation union set are required. The query corresponding to IoTDB is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">student</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">A</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, manually combine the results of the above two queries.</p></li><li><p>Query the student (name = a or phone = B or sex = C) with a score &gt; 97. Since the tag is stored in the path, there is no way to use one query to complete the <strong>or</strong> semantics of the tag. Therefore, multiple queries or operations are required to merge. The query corresponding to IoTDB is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">student</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">A</span><span style="color:#C678DD;"> where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student.*.B </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span></span>
<span class="line"><span style="color:#C678DD;">select</span><span style="color:#ABB2BF;"> * </span><span style="color:#C678DD;">from</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">monitor</span><span style="color:#ABB2BF;">.student.*.*.C </span><span style="color:#C678DD;">where</span><span style="color:#ABB2BF;"> score</span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;">97</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Finally, manually combine the results of the above three queries.</p></li></ol><h2 id="_3-support" tabindex="-1"><a class="header-anchor" href="#_3-support"><span>3. Support</span></a></h2><h3 id="_3-1-influxdb-version-support" tabindex="-1"><a class="header-anchor" href="#_3-1-influxdb-version-support"><span>3.1 InfluxDB Version Support</span></a></h3><p>Currently, supports InfluxDB 1.x version, which does not support InfluxDB 2.x version.</p><p>The Maven dependency of <code>influxdb-java</code> supports 2.21 +, and the lower version is not tested.</p><h3 id="_3-2-function-interface-support" tabindex="-1"><a class="header-anchor" href="#_3-2-function-interface-support"><span>3.2 Function Interface Support</span></a></h3><p>Currently, supports interface functions are as follows:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">public</span><span style="color:#E5C07B;"> Pong</span><span style="color:#61AFEF;"> ping</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E5C07B;"> String</span><span style="color:#61AFEF;"> version</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> flush</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> close</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E5C07B;"> InfluxDB</span><span style="color:#61AFEF;"> setDatabase</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#E5C07B;"> QueryResult</span><span style="color:#61AFEF;"> query</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> Query</span><span style="color:#E06C75;"> query)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> Point</span><span style="color:#E06C75;"> point)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> List</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> retentionPolicy</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> Point</span><span style="color:#E06C75;"> point)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#C678DD;"> int</span><span style="color:#E06C75;"> udpPort</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> Point</span><span style="color:#E06C75;"> point)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> BatchPoints</span><span style="color:#E06C75;"> batchPoints)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> retentionPolicy</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> ConsistencyLevel</span><span style="color:#E06C75;"> consistency</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> retentionPolicy</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> ConsistencyLevel</span><span style="color:#E06C75;"> consistency</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> TimeUnit</span><span style="color:#E06C75;"> precision</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> retentionPolicy</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> ConsistencyLevel</span><span style="color:#E06C75;"> consistency</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> List</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> database</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> retentionPolicy</span><span style="color:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> ConsistencyLevel</span><span style="color:#E06C75;"> consistency</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> TimeUnit</span><span style="color:#E06C75;"> precision</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> List</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#C678DD;"> int</span><span style="color:#E06C75;"> udpPort</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> write</span><span style="color:#E06C75;">(</span><span style="color:#C678DD;">final</span><span style="color:#C678DD;"> int</span><span style="color:#E06C75;"> udpPort</span><span style="color:#ABB2BF;">,</span><span style="color:#C678DD;">final</span><span style="color:#E5C07B;"> List</span><span style="color:#56B6C2;">&lt;</span><span style="color:#E06C75;">String</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> records)</span><span style="color:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-query-syntax-support" tabindex="-1"><a class="header-anchor" href="#_3-3-query-syntax-support"><span>3.3 Query Syntax Support</span></a></h3><p>The currently supported query SQL syntax is:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">SELECT</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">field_key</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;">[, &lt;field_key&gt;, &lt;tag_key&gt;]</span></span>
<span class="line"><span style="color:#C678DD;">FROM</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">measurement_name</span><span style="color:#56B6C2;">&gt;</span></span>
<span class="line"><span style="color:#C678DD;">WHERE</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">conditional_expression </span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> [( AND | OR) &lt;conditional_expression &gt; [...]</span><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>WHERE clause supports <code>conditional_expressions</code> on <code>field</code>，<code>tag</code> and <code>timestamp</code>.</p><h4 id="field" tabindex="-1"><a class="header-anchor" href="#field"><span>field</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">field_key </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">operator</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> [&#39;string&#39; | boolean | float | integer]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="tag" tabindex="-1"><a class="header-anchor" href="#tag"><span>tag</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">tag_key </span><span style="color:#56B6C2;">&lt;</span><span style="color:#ABB2BF;">operator</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> [&#39;tag_value&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="timestamp" tabindex="-1"><a class="header-anchor" href="#timestamp"><span>timestamp</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">timestamp</span><span style="color:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;">operator</span><span style="color:#56B6C2;">&gt;</span><span style="color:#E06C75;"> [&#39;time&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>At present, the filter condition of timestamp only supports the expressions related to now(), such as now () - 7d. The specific timestamp is not supported temporarily.</p>`,77)]))}const i=s(t,[["render",l],["__file","InfluxDB-Protocol.html.vue"]]),c=JSON.parse('{"path":"/UserGuide/V1.0.x/API/InfluxDB-Protocol.html","title":"","lang":"en-US","frontmatter":{"description":"0. Import Dependency Here are some examples of connecting IoTDB using the InfluxDB-Protocol adapter. 1. Switching Scheme If your original service code for accessing InfluxDB is ...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://iotdb.apache.org/zh/UserGuide/V1.0.x/API/InfluxDB-Protocol.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/UserGuide/V1.0.x/API/InfluxDB-Protocol.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:description","content":"0. Import Dependency Here are some examples of connecting IoTDB using the InfluxDB-Protocol adapter. 1. Switching Scheme If your original service code for accessing InfluxDB is ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/architecture-design.png?raw=true"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-07-10T03:11:17.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-10T03:11:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/architecture-design.png?raw=true\\",\\"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/class-diagram.png?raw=true\\",\\"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/influxdb-data.png?raw=true\\",\\"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/iotdb-data.png?raw=true\\",\\"https://alioss.timecho.com/docs/img/UserGuide/API/IoTDB-InfluxDB/influxdb-vs-iotdb-data.png?raw=true\\"],\\"dateModified\\":\\"2023-07-10T03:11:17.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"0. Import Dependency","slug":"_0-import-dependency","link":"#_0-import-dependency","children":[]},{"level":2,"title":"1. Switching Scheme","slug":"_1-switching-scheme","link":"#_1-switching-scheme","children":[]},{"level":2,"title":"2. Conceptual Design","slug":"_2-conceptual-design","link":"#_2-conceptual-design","children":[{"level":3,"title":"2.1 InfluxDB-Protocol Adapter","slug":"_2-1-influxdb-protocol-adapter","link":"#_2-1-influxdb-protocol-adapter","children":[]},{"level":3,"title":"2.2 Metadata Format Conversion","slug":"_2-2-metadata-format-conversion","link":"#_2-2-metadata-format-conversion","children":[]},{"level":3,"title":"2.3 Example","slug":"_2-3-example","link":"#_2-3-example","children":[]}]},{"level":2,"title":"3. Support","slug":"_3-support","link":"#_3-support","children":[{"level":3,"title":"3.1 InfluxDB Version Support","slug":"_3-1-influxdb-version-support","link":"#_3-1-influxdb-version-support","children":[]},{"level":3,"title":"3.2 Function Interface Support","slug":"_3-2-function-interface-support","link":"#_3-2-function-interface-support","children":[]},{"level":3,"title":"3.3 Query Syntax Support","slug":"_3-3-query-syntax-support","link":"#_3-3-query-syntax-support","children":[]}]}],"git":{"createdTime":1688958677000,"updatedTime":1688958677000,"contributors":[{"name":"CritasWang","username":"CritasWang","email":"critas@outlook.com","commits":1,"url":"https://github.com/CritasWang"}]},"readingTime":{"minutes":7.3,"words":2191},"filePathRelative":"UserGuide/V1.0.x/API/InfluxDB-Protocol.md","localizedDate":"July 10, 2023","autoDesc":true}');export{i as comp,c as data};
