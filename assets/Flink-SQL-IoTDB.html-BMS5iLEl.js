import{_ as n,c as a,b as l,o as e}from"./app-DPxWUXgB.js";const o={};function p(t,s){return e(),a("div",null,s[0]||(s[0]=[l(`<h1 id="apache-flink-sql" tabindex="-1"><a class="header-anchor" href="#apache-flink-sql"><span>Apache Flink(SQL)</span></a></h1><p>flink-sql-iotdb-connector å°† Flink SQL æˆ–è€… Flink Table ä¸ IoTDB æ— ç¼è¡”æ¥äº†èµ·æ¥ï¼Œä½¿å¾—åœ¨ Flink çš„ä»»åŠ¡ä¸­å¯ä»¥å¯¹ IoTDB è¿›è¡Œå®æ—¶è¯»å†™ï¼Œå…·ä½“å¯ä»¥åº”ç”¨åˆ°å¦‚ä¸‹åœºæ™¯ä¸­ï¼š</p><ol><li>å®æ—¶æ•°æ®åŒæ­¥ï¼šå°†æ•°æ®ä»ä¸€ä¸ªæ•°æ®åº“å®æ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ã€‚</li><li>å®æ—¶æ•°æ®ç®¡é“ï¼šæ„å»ºå®æ—¶æ•°æ®å¤„ç†ç®¡é“ï¼Œå¤„ç†å’Œåˆ†ææ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</li><li>å®æ—¶æ•°æ®åˆ†æï¼šå®æ—¶åˆ†ææ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæä¾›å®æ—¶çš„ä¸šåŠ¡æ´å¯Ÿã€‚</li><li>å®æ—¶åº”ç”¨ï¼šå°†æ•°æ®åº“ä¸­çš„æ•°æ®å®æ—¶åº”ç”¨äºå®æ—¶åº”ç”¨ç¨‹åºï¼Œå¦‚å®æ—¶æŠ¥è¡¨ã€å®æ—¶æ¨èç­‰ã€‚</li><li>å®æ—¶ç›‘æ§ï¼šå®æ—¶ç›‘æ§æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œæ£€æµ‹å¼‚å¸¸å’Œé”™è¯¯ã€‚</li></ol><h2 id="è¯»å†™æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#è¯»å†™æ¨¡å¼"><span>è¯»å†™æ¨¡å¼</span></a></h2><table><thead><tr><th>è¯»æ¨¡å¼ï¼ˆSourceï¼‰</th><th>å†™æ¨¡å¼ï¼ˆSinkï¼‰</th></tr></thead><tbody><tr><td>Bounded Scan, Lookup, CDC</td><td>Streaming Sink, Batch Sink</td></tr></tbody></table><h3 id="è¯»æ¨¡å¼-source" tabindex="-1"><a class="header-anchor" href="#è¯»æ¨¡å¼-source"><span>è¯»æ¨¡å¼ï¼ˆSourceï¼‰</span></a></h3><ul><li><p><strong>Bounded Scanï¼š</strong> bounded scan çš„ä¸»è¦å®ç°æ–¹å¼æ˜¯é€šè¿‡æŒ‡å®š <code>æ—¶é—´åºåˆ—</code> ä»¥åŠ <code>æŸ¥è¯¢æ¡ä»¶çš„ä¸Šä¸‹ç•Œï¼ˆå¯é€‰ï¼‰</code>æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æŸ¥è¯¢ç»“æœé€šå¸¸ä¸ºå¤šè¡Œæ•°æ®ã€‚è¿™ç§æŸ¥è¯¢æ— æ³•è·å–åˆ°æŸ¥è¯¢ä¹‹åæ›´æ–°çš„æ•°æ®ã€‚</p></li><li><p><strong>Lookupï¼š</strong> lookup æŸ¥è¯¢æ¨¡å¼ä¸ scan æŸ¥è¯¢æ¨¡å¼ä¸åŒï¼Œbounded scan æ˜¯å¯¹ä¸€ä¸ªæ—¶é—´èŒƒå›´å†…çš„æ•°æ®è¿›è¡ŒæŸ¥è¯¢ï¼Œè€Œ <code>lookup</code> æŸ¥è¯¢åªä¼šå¯¹ä¸€ä¸ªç²¾ç¡®çš„æ—¶é—´ç‚¹è¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥æŸ¥è¯¢ç»“æœåªæœ‰ä¸€è¡Œæ•°æ®ã€‚å¦å¤–åªæœ‰ <code>lookup join</code> çš„å³è¡¨æ‰èƒ½ä½¿ç”¨ lookup æŸ¥è¯¢æ¨¡å¼ã€‚</p></li><li><p><strong>CDC:</strong> ä¸»è¦ç”¨äº Flink çš„ <code>ETL</code> ä»»åŠ¡å½“ä¸­ã€‚å½“ IoTDB ä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œflink ä¼šé€šè¿‡æˆ‘ä»¬æä¾›çš„ <code>CDC connector</code> æ„ŸçŸ¥åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ„ŸçŸ¥åˆ°çš„å˜åŒ–æ•°æ®è½¬å‘ç»™å…¶ä»–çš„å¤–éƒ¨æ•°æ®æºï¼Œä»¥æ­¤è¾¾åˆ° ETL çš„ç›®çš„ã€‚</p></li></ul><h3 id="å†™æ¨¡å¼-sink" tabindex="-1"><a class="header-anchor" href="#å†™æ¨¡å¼-sink"><span>å†™æ¨¡å¼ï¼ˆSinkï¼‰</span></a></h3><ul><li><p><strong>Streaming sinkï¼š</strong> ç”¨äº Flink çš„ streaming mode ä¸­ï¼Œä¼šå°† Flink ä¸­ Dynamic Table çš„å¢åˆ æ”¹è®°å½•å®æ—¶çš„åŒæ­¥åˆ° IoTDB ä¸­ã€‚</p></li><li><p><strong>Batch sinkï¼š</strong> ç”¨äº Flink çš„ batch mode ä¸­ï¼Œç”¨äºå°† Flink çš„æ‰¹é‡è®¡ç®—ç»“æœä¸€æ¬¡æ€§å†™å…¥ IoTDB ä¸­ã€‚</p></li></ul><h2 id="ä½¿ç”¨æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨æ–¹å¼"><span>ä½¿ç”¨æ–¹å¼</span></a></h2><p>æˆ‘ä»¬æä¾›çš„ flink-sql-iotdb-connector æ€»å…±æä¾›ä¸¤ç§ä½¿ç”¨æ–¹å¼ï¼Œä¸€ç§æ˜¯åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹ä¸­é€šè¿‡ Maven çš„æ–¹å¼å¼•ç”¨ï¼Œå¦å¤–ä¸€ç§æ˜¯åœ¨ Flink çš„ sql-client ä¸­ä½¿ç”¨ã€‚æˆ‘ä»¬å°†åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§ä½¿ç”¨æ–¹å¼ã€‚</p><blockquote><p>ğŸ“Œæ³¨ï¼šflink ç‰ˆæœ¬è¦æ±‚ 1.17.0 åŠä»¥ä¸Š</p></blockquote><h3 id="maven" tabindex="-1"><a class="header-anchor" href="#maven"><span>Maven</span></a></h3><p>æˆ‘ä»¬åªéœ€è¦åœ¨é¡¹ç›®çš„ pom æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å³å¯ï¼š</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">&lt;</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;org.apache.iotdb&lt;/</span><span style="color:#E06C75;">groupId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;flink-sql-iotdb-connector&lt;/</span><span style="color:#E06C75;">artifactId</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">    &lt;</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;\${iotdb.version}&lt;/</span><span style="color:#E06C75;">version</span><span style="color:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;">&lt;/</span><span style="color:#E06C75;">dependency</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="sql-client" tabindex="-1"><a class="header-anchor" href="#sql-client"><span>sql-client</span></a></h3><p>å¦‚æœéœ€è¦åœ¨ sql-client ä¸­ä½¿ç”¨ flink-sql-iotdb-connectorï¼Œå…ˆé€šè¿‡ä»¥ä¸‹æ­¥éª¤æ¥é…ç½®ç¯å¢ƒï¼š</p><ol><li><p>åœ¨ <a href="https://iotdb.apache.org/Download/" target="_blank" rel="noopener noreferrer">å®˜ç½‘</a> ä¸‹è½½å¸¦ä¾èµ–çš„ flink-sql-iotdb-connector çš„ jar åŒ…ã€‚</p></li><li><p>å°† jar åŒ…æ‹·è´åˆ° <code>$FLINK_HOME/lib</code> ç›®å½•ä¸‹ã€‚</p></li><li><p>å¯åŠ¨ Flink é›†ç¾¤ã€‚</p></li><li><p>å¯åŠ¨ sql-clientã€‚</p></li></ol><p>æ­¤æ—¶å°±å¯ä»¥åœ¨ sql-client ä¸­ä½¿ç”¨ flink-sql-iotdb-connector äº†ã€‚</p><h2 id="è¡¨ç»“æ„è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#è¡¨ç»“æ„è§„èŒƒ"><span>è¡¨ç»“æ„è§„èŒƒ</span></a></h2><p>æ— è®ºä½¿ç”¨å“ªç§ç±»å‹çš„è¿æ¥å™¨ï¼Œéƒ½éœ€è¦æ»¡è¶³ä»¥ä¸‹çš„è¡¨ç»“æ„è§„èŒƒï¼š</p><ul><li>æ‰€æœ‰ä½¿ç”¨ <code>IoTDB connector</code> çš„è¡¨ï¼Œç¬¬ä¸€åˆ—çš„åˆ—åå¿…é¡»æ˜¯ <code>Time_</code>ï¼Œè€Œä¸”æ•°æ®ç±»å‹å¿…é¡»æ˜¯ <code>BIGINT</code> ç±»å‹ã€‚</li><li>é™¤äº† <code>Time_</code> åˆ—ä»¥å¤–çš„åˆ—åå¿…é¡»ä»¥ <code>root.</code> å¼€å¤´ã€‚å¦å¤–åˆ—åä¸­çš„ä»»æ„èŠ‚ç‚¹ä¸èƒ½æ˜¯çº¯æ•°å­—ï¼Œå¦‚æœæœ‰çº¯æ•°å­—ï¼Œæˆ–è€…å…¶ä»–éæ³•å­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åå¼•å·æ‰©èµ·æ¥ã€‚æ¯”å¦‚ï¼šè·¯å¾„ root.sg.d0.123 æ˜¯ä¸€ä¸ªéæ³•è·¯å¾„ï¼Œä½†æ˜¯ root.sg.d0.\`123\` å°±æ˜¯ä¸€ä¸ªåˆæ³•è·¯å¾„ã€‚</li><li>æ— è®ºä½¿ç”¨ <code>pattern</code> æˆ–è€… <code>sql</code> ä» IoTDB ä¸­æŸ¥è¯¢æ•°æ®ï¼ŒæŸ¥è¯¢ç»“æœçš„æ—¶é—´åºåˆ—åéœ€è¦åŒ…å« Flink ä¸­é™¤äº† <code>Time_</code> ä»¥å¤–çš„æ‰€æœ‰åˆ—åã€‚å¦‚æœæ²¡æœ‰æŸ¥è¯¢ç»“æœä¸­æ²¡æœ‰ç›¸åº”çš„åˆ—åï¼Œåˆ™è¯¥åˆ—å°†ç”¨ null å»å¡«å……ã€‚</li><li>flink-sql-iotdb-connector ä¸­æ”¯æŒçš„æ•°æ®ç±»å‹æœ‰ï¼š<code>INT</code>, <code>BIGINT</code>, <code>FLOAT</code>, <code>DOUBLE</code>, <code>BOOLEAN</code>, <code>STRING</code>ã€‚Flink Table ä¸­æ¯ä¸€åˆ—çš„æ•°æ®ç±»å‹ä¸å…¶ IoTDB ä¸­å¯¹åº”çš„æ—¶é—´åºåˆ—ç±»å‹éƒ½è¦åŒ¹é…ä¸Šï¼Œå¦åˆ™å°†ä¼šæŠ¥é”™ï¼Œå¹¶é€€å‡º Flink ä»»åŠ¡ã€‚</li></ul><p>ä»¥ä¸‹ç”¨å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ IoTDB ä¸­çš„æ—¶é—´åºåˆ—ä¸ Flink Table ä¸­åˆ—çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="è¯»æ¨¡å¼-source-1" tabindex="-1"><a class="header-anchor" href="#è¯»æ¨¡å¼-source-1"><span>è¯»æ¨¡å¼ï¼ˆSourceï¼‰</span></a></h2><h3 id="scan-table-bounded" tabindex="-1"><a class="header-anchor" href="#scan-table-bounded"><span>Scan Table (Bounded)</span></a></h3><h4 id="å‚æ•°" tabindex="-1"><a class="header-anchor" href="#å‚æ•°"><span>å‚æ•°</span></a></h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>scan.bounded.lower-bound</td><td>å¦</td><td>-1L</td><td>Long</td><td>bounded çš„ scan æŸ¥è¯¢æ—¶çš„æ—¶é—´æˆ³ä¸‹ç•Œï¼ˆåŒ…æ‹¬ï¼‰ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶æœ‰æ•ˆã€‚</td></tr><tr><td>scan.bounded.upper-bound</td><td>å¦</td><td>-1L</td><td>Long</td><td>bounded çš„ scan æŸ¥è¯¢æ—¶çš„æ—¶é—´æˆ³ä¸‹ç•Œï¼ˆåŒ…æ‹¬ï¼‰ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶æœ‰æ•ˆã€‚</td></tr><tr><td>sql</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹"><span>ç¤ºä¾‹</span></a></h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table Job ä¸­ä» IoTDB ä¸­é€šè¿‡<code>scan table</code>çš„æ–¹å¼è¯»å–æ•°æ®ï¼š<br> å½“å‰ IoTDB ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>IoTDB&gt; select ** from root;</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>Total line number = 5</span></span>
<span class="line"><span>It costs 0.028s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.*</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> BoundedScanTest</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> Exception</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup table environment</span></span>
<span class="line"><span style="color:#E5C07B;">    EnvironmentSettings</span><span style="color:#E06C75;"> settings</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> EnvironmentSettings</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newInstance</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">inStreamingMode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableEnvironment</span><span style="color:#E06C75;"> tableEnv</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableEnvironment</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(settings);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup schema</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> iotdbTableSchema</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            Schema</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // register table</span></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> iotdbDescriptor</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            TableDescriptor</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(iotdbTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;nodeUrls&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;127.0.0.1:6667&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sql&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;select ** from root&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbTable&quot;</span><span style="color:#ABB2BF;">, iotdbDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // output table</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbTable&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œä»¥ä¸Šä»»åŠ¡åï¼ŒFlink çš„æ§åˆ¶å°ä¸­è¾“å‡ºçš„è¡¨å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+</span></span>
<span class="line"><span>| op |                Time_ |                  root.sg.d0.s0 |                  root.sg.d1.s0 |                  root.sg.d1.s1 |</span></span>
<span class="line"><span>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+</span></span>
<span class="line"><span>| +I |                    1 |                      1.0833644 |                        2.34874 |                      1.2414109 |</span></span>
<span class="line"><span>| +I |                    2 |                       4.929185 |                      3.1885583 |                      4.6980085 |</span></span>
<span class="line"><span>| +I |                    3 |                      3.5206156 |                      3.5600138 |                      4.8080945 |</span></span>
<span class="line"><span>| +I |                    4 |                      1.3449302 |                      2.8781595 |                      3.3195343 |</span></span>
<span class="line"><span>| +I |                    5 |                      3.3079383 |                      3.3840187 |                      3.7278645 |</span></span>
<span class="line"><span>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lookup-point" tabindex="-1"><a class="header-anchor" href="#lookup-point"><span>Lookup Point</span></a></h3><h4 id="å‚æ•°-1" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-1"><span>å‚æ•°</span></a></h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>lookup.cache.max-rows</td><td>å¦</td><td>-1</td><td>Integer</td><td>lookup æŸ¥è¯¢æ—¶ï¼Œç¼“å­˜è¡¨çš„æœ€å¤§è¡Œæ•°ï¼Œå‚æ•°å¤§äº<code>0</code>æ—¶ç”Ÿæ•ˆã€‚</td></tr><tr><td>lookup.cache.ttl-sec</td><td>å¦</td><td>-1</td><td>Integer</td><td>lookup æŸ¥è¯¢æ—¶ï¼Œå•ç‚¹æ•°æ®çš„ä¸¢å¼ƒæ—¶é—´ï¼Œå•ä½ä¸º<code>ç§’</code>ã€‚</td></tr><tr><td>sql</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-1" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-1"><span>ç¤ºä¾‹</span></a></h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•å°† IoTDB ä¸­çš„<code>device</code>ä½œä¸ºç»´åº¦è¡¨è¿›è¡Œ<code>lookup</code>æŸ¥è¯¢ï¼š</p><ul><li>ä½¿ç”¨ <code>datagen connector</code> ç”Ÿæˆä¸¤ä¸ªå­—æ®µä½œä¸º <code>Lookup Join</code> çš„å·¦è¡¨ã€‚ç¬¬ä¸€ä¸ªå­—æ®µä¸ºè‡ªå¢å­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºæ—¶é—´æˆ³ã€‚ç¬¬äºŒä¸ªå­—æ®µä¸ºéšæœºå­—æ®µï¼Œç”¨æ¥è¡¨ç¤ºä¸€ä¸ª<br> measurement äº§ç”Ÿçš„æ—¶é—´åºåˆ—ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¡¨ä½œä¸º <code>Lookup Join</code> çš„å³è¡¨ã€‚</li><li>å°†ä¸¤ä¸ªè¡¨ join èµ·æ¥ã€‚</li></ul><p>å½“å‰ IoTDB ä¸­çš„æ•°æ®å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>IoTDB&gt; select ** from root;</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>Total line number = 5</span></span>
<span class="line"><span>It costs 0.028s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.DataTypes</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.EnvironmentSettings</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Schema</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableDescriptor</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableEnvironment</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> LookupTest</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup environment</span></span>
<span class="line"><span style="color:#E5C07B;">    EnvironmentSettings</span><span style="color:#E06C75;"> settings</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> EnvironmentSettings</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newInstance</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">inStreamingMode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableEnvironment</span><span style="color:#E06C75;"> tableEnv</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableEnvironment</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(settings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // register left table</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> dataGenTableSchema</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            Schema</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">INT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> datagenDescriptor</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            TableDescriptor</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;datagen&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(dataGenTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.kind&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;sequence&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.start&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.end&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;5&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.s0.min&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.s0.max&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;leftTable&quot;</span><span style="color:#ABB2BF;">, datagenDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // register right table</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> iotdbTableSchema</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            Schema</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> iotdbDescriptor</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#E5C07B;">            TableDescriptor</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(iotdbTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sql&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;select ** from root&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                    .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;rightTable&quot;</span><span style="color:#ABB2BF;">, iotdbDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // join</span></span>
<span class="line"><span style="color:#E5C07B;">    String</span><span style="color:#E06C75;"> sql</span><span style="color:#56B6C2;"> =</span></span>
<span class="line"><span style="color:#98C379;">            &quot;SELECT l.Time_, l.s0,r.\`root.sg.d0.s0\`, r.\`root.sg.d1.s0\`, r.\`root.sg.d1.s1\`&quot;</span></span>
<span class="line"><span style="color:#56B6C2;">                    +</span><span style="color:#98C379;"> &quot;FROM (select *,PROCTIME() as proc_time from leftTable) AS l &quot;</span></span>
<span class="line"><span style="color:#56B6C2;">                    +</span><span style="color:#98C379;"> &quot;JOIN rightTable FOR SYSTEM_TIME AS OF l.proc_time AS r &quot;</span></span>
<span class="line"><span style="color:#56B6C2;">                    +</span><span style="color:#98C379;"> &quot;ON l.Time_ = r.Time_&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // output table</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">sqlQuery</span><span style="color:#ABB2BF;">(sql).</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œå®Œä»¥ä¸Šä»»åŠ¡åï¼ŒFlink çš„æ§åˆ¶å°ä¸­è¾“å‡ºçš„è¡¨å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+----+----------------------+-------------+---------------+----------------------+--------------------------------+</span></span>
<span class="line"><span>| op |                Time_ |          s0 | root.sg.d0.s0 |        root.sg.d1.s0 |                  root.sg.d1.s1 |</span></span>
<span class="line"><span>+----+----------------------+-------------+---------------+----------------------+--------------------------------+</span></span>
<span class="line"><span>| +I |                    5 |           1 |     3.3079383 |            3.3840187 |                      3.7278645 |</span></span>
<span class="line"><span>| +I |                    2 |           1 |      4.929185 |            3.1885583 |                      4.6980085 |</span></span>
<span class="line"><span>| +I |                    1 |           1 |     1.0833644 |              2.34874 |                      1.2414109 |</span></span>
<span class="line"><span>| +I |                    4 |           1 |     1.3449302 |            2.8781595 |                      3.3195343 |</span></span>
<span class="line"><span>| +I |                    3 |           1 |     3.5206156 |            3.5600138 |                      4.8080945 |</span></span>
<span class="line"><span>+----+----------------------+-------------+---------------+----------------------+--------------------------------+</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cdc" tabindex="-1"><a class="header-anchor" href="#cdc"><span>CDC</span></a></h3><h4 id="å‚æ•°-2" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-2"><span>å‚æ•°</span></a></h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>mode</td><td>æ˜¯</td><td>BOUNDED</td><td>ENUM</td><td><strong>å¿…é¡»å°†æ­¤å‚æ•°è®¾ç½®ä¸º <code>CDC</code> æ‰èƒ½å¯åŠ¨</strong></td></tr><tr><td>sql</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>ç”¨äºåœ¨ IoTDB ç«¯åšæŸ¥è¯¢ã€‚</td></tr><tr><td>cdc.port</td><td>å¦</td><td>8080</td><td>Integer</td><td>åœ¨ IoTDB ç«¯æä¾› CDC æœåŠ¡çš„ç«¯å£å·ã€‚</td></tr><tr><td><a href="http://cdc.task.name" target="_blank" rel="noopener noreferrer">cdc.task.name</a></td><td>æ˜¯</td><td>æ— </td><td>String</td><td>å½“ mode å‚æ•°è®¾ç½®ä¸º CDC æ—¶æ˜¯å¿…å¡«é¡¹ã€‚ç”¨äºåœ¨ IoTDB ç«¯åˆ›å»º Pipe ä»»åŠ¡ã€‚</td></tr><tr><td>cdc.pattern</td><td>æ˜¯</td><td>æ— </td><td>String</td><td>å½“ mode å‚æ•°è®¾ç½®ä¸º CDC æ—¶æ˜¯å¿…å¡«é¡¹ã€‚ç”¨äºåœ¨ IoTDB ç«¯ä½œä¸ºå‘é€æ•°æ®çš„è¿‡æ»¤æ¡ä»¶ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-2" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-2"><span>ç¤ºä¾‹</span></a></h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•é€šè¿‡ <code>CDC Connector</code> å»è·å– IoTDB ä¸­æŒ‡å®šè·¯å¾„ä¸‹çš„å˜åŒ–æ•°æ®ï¼š</p><ul><li>é€šè¿‡ <code>CDC Connector</code> åˆ›å»ºä¸€å¼  <code>CDC</code> è¡¨ã€‚</li><li>å°† <code>CDC</code> è¡¨æ‰“å°å‡ºæ¥ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.*</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> CDCTest</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup environment</span></span>
<span class="line"><span style="color:#E5C07B;">    EnvironmentSettings</span><span style="color:#E06C75;"> settings</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> EnvironmentSettings</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newInstance</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">inStreamingMode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableEnvironment</span><span style="color:#E06C75;"> tableEnv</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableEnvironment</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(settings);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup schema</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> iotdbTableSchema</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Schema</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // register table</span></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> iotdbDescriptor</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableDescriptor</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(iotdbTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;mode&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;CDC&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cdc.task.name&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;test&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;cdc.pattern&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;root.sg&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbTable&quot;</span><span style="color:#ABB2BF;">, iotdbDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // output table</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbTable&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œä»¥ä¸Šçš„ Flink CDC ä»»åŠ¡ï¼Œç„¶ååœ¨ IoTDB-cli ä¸­æ‰§è¡Œä»¥ä¸‹ SQLï¼š</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">insert into</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">sg</span><span style="color:#ABB2BF;">.d1(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">,s0,s1) </span><span style="color:#C678DD;">values</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">insert into</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">sg</span><span style="color:#ABB2BF;">.d1(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">,s0,s1) </span><span style="color:#C678DD;">values</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">insert into</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">sg</span><span style="color:#ABB2BF;">.d1(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">,s0,s1) </span><span style="color:#C678DD;">values</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">6</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">insert into</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">sg</span><span style="color:#ABB2BF;">.d0(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">,s0) </span><span style="color:#C678DD;">values</span><span style="color:#ABB2BF;">(</span><span style="color:#D19A66;">7</span><span style="color:#ABB2BF;">,</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼ŒFlink çš„æ§åˆ¶å°ä¸­å°†æ‰“å°è¯¥æ¡æ•°æ®ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+</span></span>
<span class="line"><span>| op |                Time_ |                  root.sg.d0.s0 |                  root.sg.d1.s0 |                  root.sg.d1.s1 |</span></span>
<span class="line"><span>+----+----------------------+--------------------------------+--------------------------------+--------------------------------+</span></span>
<span class="line"><span>| +I |                    7 |                         &lt;NULL&gt; |                            1.0 |                            1.0 |</span></span>
<span class="line"><span>| +I |                    6 |                         &lt;NULL&gt; |                            1.0 |                            1.0 |</span></span>
<span class="line"><span>| +I |                    6 |                         &lt;NULL&gt; |                            2.0 |                            1.0 |</span></span>
<span class="line"><span>| +I |                    7 |                            2.0 |                         &lt;NULL&gt; |                         &lt;NULL&gt; |</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å†™æ¨¡å¼-sink-1" tabindex="-1"><a class="header-anchor" href="#å†™æ¨¡å¼-sink-1"><span>å†™æ¨¡å¼ï¼ˆSinkï¼‰</span></a></h2><h3 id="streaming-sink" tabindex="-1"><a class="header-anchor" href="#streaming-sink"><span>Streaming Sink</span></a></h3><h4 id="å‚æ•°-3" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-3"><span>å‚æ•°</span></a></h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>aligned</td><td>å¦</td><td>false</td><td>Boolean</td><td>å‘ IoTDB å†™å…¥æ•°æ®æ—¶æ˜¯å¦è°ƒç”¨<code>aligned</code>æ¥å£ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-3" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-3"><span>ç¤ºä¾‹</span></a></h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table çš„ Streaming Job ä¸­å¦‚ä½•å°†æ•°æ®å†™å…¥åˆ° IoTDB ä¸­ï¼š</p><ul><li>é€šè¿‡ <code>datagen connector</code> ç”Ÿæˆä¸€å¼ æºæ•°æ®è¡¨ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¾“å‡ºè¡¨ã€‚</li><li>å°†æ•°æ®æºè¡¨çš„æ•°æ®æ’å…¥åˆ°è¾“å‡ºè¡¨ä¸­ã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.DataTypes</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.EnvironmentSettings</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Schema</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Table</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableDescriptor</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableEnvironment</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> StreamingSinkTest</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        // setup environment</span></span>
<span class="line"><span style="color:#E5C07B;">        EnvironmentSettings</span><span style="color:#E06C75;"> settings</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> EnvironmentSettings</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">newInstance</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">inStreamingMode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">        TableEnvironment</span><span style="color:#E06C75;"> tableEnv</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableEnvironment</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(settings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        // create data source table</span></span>
<span class="line"><span style="color:#E5C07B;">        Schema</span><span style="color:#E06C75;"> dataGenTableSchema</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Schema</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">        TableDescriptor</span><span style="color:#E06C75;"> descriptor</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableDescriptor</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;datagen&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(dataGenTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;rows-per-second&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.kind&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;sequence&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.start&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.Time_.end&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;5&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d0.s0.min&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d0.s0.max&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;5&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d1.s0.min&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d1.s0.max&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;5&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d1.s1.min&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;fields.root.sg.d1.s1.max&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;5&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        // register source table</span></span>
<span class="line"><span style="color:#E5C07B;">        tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;dataGenTable&quot;</span><span style="color:#ABB2BF;">, descriptor);</span></span>
<span class="line"><span style="color:#E5C07B;">        Table</span><span style="color:#E06C75;"> dataGenTable</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;dataGenTable&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        // create iotdb sink table</span></span>
<span class="line"><span style="color:#E5C07B;">        TableDescriptor</span><span style="color:#E06C75;"> iotdbDescriptor</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableDescriptor</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(dataGenTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">                .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">        tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbSinkTable&quot;</span><span style="color:#ABB2BF;">, iotdbDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">        // insert data</span></span>
<span class="line"><span style="color:#E5C07B;">        dataGenTable</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">executeInsert</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;iotdbSinkTable&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œåœ¨ IoTDB çš„ cli ä¸­æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>IoTDB&gt; select ** from root;</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>Total line number = 5</span></span>
<span class="line"><span>It costs 0.054s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="batch-sink" tabindex="-1"><a class="header-anchor" href="#batch-sink"><span>Batch Sink</span></a></h3><h4 id="å‚æ•°-4" tabindex="-1"><a class="header-anchor" href="#å‚æ•°-4"><span>å‚æ•°</span></a></h4><table><thead><tr><th>å‚æ•°</th><th>å¿…å¡«</th><th>é»˜è®¤</th><th>ç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>nodeUrls</td><td>å¦</td><td>127.0.0.1:6667</td><td>String</td><td>ç”¨æ¥æŒ‡å®š IoTDB çš„ datanode åœ°å€ï¼Œå¦‚æœ IoTDB æ˜¯ç”¨é›†ç¾¤æ¨¡å¼æ­å»ºçš„è¯ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ªåœ°å€ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç”¨é€—å·éš”å¼€ã€‚</td></tr><tr><td>user</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB ç”¨æˆ·å</td></tr><tr><td>password</td><td>å¦</td><td>root</td><td>String</td><td>IoTDB å¯†ç </td></tr><tr><td>aligned</td><td>å¦</td><td>false</td><td>Boolean</td><td>å‘ IoTDB å†™å…¥æ•°æ®æ—¶æ˜¯å¦è°ƒç”¨<code>aligned</code>æ¥å£ã€‚</td></tr></tbody></table><h4 id="ç¤ºä¾‹-4" tabindex="-1"><a class="header-anchor" href="#ç¤ºä¾‹-4"><span>ç¤ºä¾‹</span></a></h4><p>è¯¥ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ª Flink Table çš„ Batch Job ä¸­å¦‚ä½•å°†æ•°æ®å†™å…¥åˆ° IoTDB ä¸­ï¼š</p><ul><li>é€šè¿‡ <code>IoTDB connector</code> ç”Ÿæˆä¸€å¼ æºæ•°æ®è¡¨ã€‚</li><li>é€šè¿‡ <code>IoTDB connector</code> æ³¨å†Œä¸€ä¸ªè¾“å‡ºè¡¨ã€‚</li><li>å°†åŸæ•°æ®è¡¨ä¸­çš„åˆ—é‡å‘½ååå†™å…¥å†™å› IoTDBã€‚</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.DataTypes</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.EnvironmentSettings</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Schema</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Table</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableDescriptor</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#E5C07B;"> org.apache.flink.table.api.TableEnvironment</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">import</span><span style="color:#C678DD;"> static</span><span style="color:#E5C07B;"> org.apache.flink.table.api.Expressions.$</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> BatchSinkTest</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> static</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> main</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">args</span><span style="color:#ABB2BF;">)</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // setup environment</span></span>
<span class="line"><span style="color:#E5C07B;">    EnvironmentSettings</span><span style="color:#E06C75;"> settings</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> EnvironmentSettings</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newInstance</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">inBatchMode</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableEnvironment</span><span style="color:#E06C75;"> tableEnv</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableEnvironment</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">create</span><span style="color:#ABB2BF;">(settings);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // create source table</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> sourceTableSchema</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Schema</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> sourceTableDescriptor</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableDescriptor</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(sourceTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">option</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sql&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;select ** from root.sg.d0,root.sg.d1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sourceTable&quot;</span><span style="color:#ABB2BF;">, sourceTableDescriptor);</span></span>
<span class="line"><span style="color:#E5C07B;">    Table</span><span style="color:#E06C75;"> sourceTable</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">from</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sourceTable&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // register sink table</span></span>
<span class="line"><span style="color:#E5C07B;">    Schema</span><span style="color:#E06C75;"> sinkTableSchema</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> Schema</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">newBuilder</span><span style="color:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;Time_&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">BIGINT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d2.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d3.s0&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">column</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d3.s1&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">DataTypes</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">FLOAT</span><span style="color:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    TableDescriptor</span><span style="color:#E06C75;"> sinkTableDescriptor</span><span style="color:#56B6C2;"> =</span><span style="color:#E5C07B;"> TableDescriptor</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">forConnector</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;IoTDB&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">schema</span><span style="color:#ABB2BF;">(sinkTableSchema)</span></span>
<span class="line"><span style="color:#ABB2BF;">            .</span><span style="color:#61AFEF;">build</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;">    tableEnv</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">createTemporaryTable</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sinkTable&quot;</span><span style="color:#ABB2BF;">, sinkTableDescriptor);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    // insert data</span></span>
<span class="line"><span style="color:#E5C07B;">    sourceTable</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">renameColumns</span><span style="color:#ABB2BF;">(</span></span>
<span class="line"><span style="color:#61AFEF;">            $</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d0.s0&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">as</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d2.s0&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#61AFEF;">            $</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s0&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">as</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d3.s0&quot;</span><span style="color:#ABB2BF;">),</span></span>
<span class="line"><span style="color:#61AFEF;">            $</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d1.s1&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">as</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;root.sg.d3.s1&quot;</span><span style="color:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;">    ).</span><span style="color:#61AFEF;">insertInto</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;sinkTable&quot;</span><span style="color:#ABB2BF;">).</span><span style="color:#61AFEF;">execute</span><span style="color:#ABB2BF;">().</span><span style="color:#61AFEF;">print</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»»åŠ¡æ‰§è¡Œå®Œæˆåï¼Œåœ¨ IoTDB çš„ cli ä¸­æŸ¥è¯¢ç»“æœå¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" data-title="text" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>IoTDB&gt; select ** from root;</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|                         Time|root.sg.d0.s0|root.sg.d1.s0|root.sg.d1.s1|root.sg.d2.s0|root.sg.d3.s0|root.sg.d3.s1|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>|1970-01-01T08:00:00.001+08:00|    1.0833644|      2.34874|    1.2414109|    1.0833644|      2.34874|    1.2414109|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.002+08:00|     4.929185|    3.1885583|    4.6980085|     4.929185|    3.1885583|    4.6980085|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.003+08:00|    3.5206156|    3.5600138|    4.8080945|    3.5206156|    3.5600138|    4.8080945|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.004+08:00|    1.3449302|    2.8781595|    3.3195343|    1.3449302|    2.8781595|    3.3195343|</span></span>
<span class="line"><span>|1970-01-01T08:00:00.005+08:00|    3.3079383|    3.3840187|    3.7278645|    3.3079383|    3.3840187|    3.7278645|</span></span>
<span class="line"><span>+-----------------------------+-------------+-------------+-------------+-------------+-------------+-------------+</span></span>
<span class="line"><span>Total line number = 5</span></span>
<span class="line"><span>It costs 0.015s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,74)]))}const r=n(o,[["render",p],["__file","Flink-SQL-IoTDB.html.vue"]]),i=JSON.parse('{"path":"/zh/UserGuide/V1.2.x/Ecosystem-Integration/Flink-SQL-IoTDB.html","title":"Apache Flink(SQL)","lang":"zh-CN","frontmatter":{"description":"Apache Flink(SQL) flink-sql-iotdb-connector å°† Flink SQL æˆ–è€… Flink Table ä¸ IoTDB æ— ç¼è¡”æ¥äº†èµ·æ¥ï¼Œä½¿å¾—åœ¨ Flink çš„ä»»åŠ¡ä¸­å¯ä»¥å¯¹ IoTDB è¿›è¡Œå®æ—¶è¯»å†™ï¼Œå…·ä½“å¯ä»¥åº”ç”¨åˆ°å¦‚ä¸‹åœºæ™¯ä¸­ï¼š å®æ—¶æ•°æ®åŒæ­¥ï¼šå°†æ•°æ®ä»ä¸€ä¸ªæ•°æ®åº“å®æ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ã€‚ å®æ—¶æ•°æ®ç®¡é“ï¼šæ„å»ºå®æ—¶æ•°æ®å¤„ç†ç®¡...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://iotdb.apache.org/UserGuide/V1.2.x/Ecosystem-Integration/Flink-SQL-IoTDB.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/zh/UserGuide/V1.2.x/Ecosystem-Integration/Flink-SQL-IoTDB.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:title","content":"Apache Flink(SQL)"}],["meta",{"property":"og:description","content":"Apache Flink(SQL) flink-sql-iotdb-connector å°† Flink SQL æˆ–è€… Flink Table ä¸ IoTDB æ— ç¼è¡”æ¥äº†èµ·æ¥ï¼Œä½¿å¾—åœ¨ Flink çš„ä»»åŠ¡ä¸­å¯ä»¥å¯¹ IoTDB è¿›è¡Œå®æ—¶è¯»å†™ï¼Œå…·ä½“å¯ä»¥åº”ç”¨åˆ°å¦‚ä¸‹åœºæ™¯ä¸­ï¼š å®æ—¶æ•°æ®åŒæ­¥ï¼šå°†æ•°æ®ä»ä¸€ä¸ªæ•°æ®åº“å®æ—¶åŒæ­¥åˆ°å¦ä¸€ä¸ªæ•°æ®åº“ã€‚ å®æ—¶æ•°æ®ç®¡é“ï¼šæ„å»ºå®æ—¶æ•°æ®å¤„ç†ç®¡..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-08-12T04:20:54.000Z"}],["meta",{"property":"article:modified_time","content":"2024-08-12T04:20:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Apache Flink(SQL)\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-12T04:20:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"è¯»å†™æ¨¡å¼","slug":"è¯»å†™æ¨¡å¼","link":"#è¯»å†™æ¨¡å¼","children":[{"level":3,"title":"è¯»æ¨¡å¼ï¼ˆSourceï¼‰","slug":"è¯»æ¨¡å¼-source","link":"#è¯»æ¨¡å¼-source","children":[]},{"level":3,"title":"å†™æ¨¡å¼ï¼ˆSinkï¼‰","slug":"å†™æ¨¡å¼-sink","link":"#å†™æ¨¡å¼-sink","children":[]}]},{"level":2,"title":"ä½¿ç”¨æ–¹å¼","slug":"ä½¿ç”¨æ–¹å¼","link":"#ä½¿ç”¨æ–¹å¼","children":[{"level":3,"title":"Maven","slug":"maven","link":"#maven","children":[]},{"level":3,"title":"sql-client","slug":"sql-client","link":"#sql-client","children":[]}]},{"level":2,"title":"è¡¨ç»“æ„è§„èŒƒ","slug":"è¡¨ç»“æ„è§„èŒƒ","link":"#è¡¨ç»“æ„è§„èŒƒ","children":[]},{"level":2,"title":"è¯»æ¨¡å¼ï¼ˆSourceï¼‰","slug":"è¯»æ¨¡å¼-source-1","link":"#è¯»æ¨¡å¼-source-1","children":[{"level":3,"title":"Scan Table (Bounded)","slug":"scan-table-bounded","link":"#scan-table-bounded","children":[]},{"level":3,"title":"Lookup Point","slug":"lookup-point","link":"#lookup-point","children":[]},{"level":3,"title":"CDC","slug":"cdc","link":"#cdc","children":[]}]},{"level":2,"title":"å†™æ¨¡å¼ï¼ˆSinkï¼‰","slug":"å†™æ¨¡å¼-sink-1","link":"#å†™æ¨¡å¼-sink-1","children":[{"level":3,"title":"Streaming Sink","slug":"streaming-sink","link":"#streaming-sink","children":[]},{"level":3,"title":"Batch Sink","slug":"batch-sink","link":"#batch-sink","children":[]}]}],"git":{"createdTime":1694658523000,"updatedTime":1723436454000,"contributors":[{"name":"W1y1r","username":"W1y1r","email":"150988475+W1y1r@users.noreply.github.com","commits":1,"url":"https://github.com/W1y1r"},{"name":"wanghui42","username":"wanghui42","email":"105700158+wanghui42@users.noreply.github.com","commits":1,"url":"https://github.com/wanghui42"},{"name":"Xuan Ronaldo","username":"Xuan Ronaldo","email":"xuanronaldo@qq.com","commits":2,"url":"https://github.com/Xuan Ronaldo"}]},"readingTime":{"minutes":10.18,"words":3053},"filePathRelative":"zh/UserGuide/V1.2.x/Ecosystem-Integration/Flink-SQL-IoTDB.md","localizedDate":"2023å¹´9æœˆ14æ—¥","autoDesc":true}');export{r as comp,i as data};
