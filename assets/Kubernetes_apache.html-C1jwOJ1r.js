import{_ as n,c as a,b as e,o as l}from"./app-BrzuM4xY.js";const o={};function t(i,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="kubernetes" tabindex="-1"><a class="header-anchor" href="#kubernetes"><span>Kubernetes</span></a></h1><h2 id="_1-环境准备" tabindex="-1"><a class="header-anchor" href="#_1-环境准备"><span>1. 环境准备</span></a></h2><h3 id="_1-1-准备-kubernetes-集群" tabindex="-1"><a class="header-anchor" href="#_1-1-准备-kubernetes-集群"><span>1.1 准备 Kubernetes 集群</span></a></h3><p>确保拥有一个可用的 Kubernetes 集群（建议最低版本：Kubernetes 1.24），作为部署 IoTDB 集群的基础。</p><p>Kubernetes 版本要求：建议版本为 Kubernetes 1.24及以上</p><p>IoTDB版本要求：不能低于v1.3.3.2</p><h2 id="_2-创建命名空间" tabindex="-1"><a class="header-anchor" href="#_2-创建命名空间"><span>2. 创建命名空间</span></a></h2><h3 id="_2-1-创建命名空间" tabindex="-1"><a class="header-anchor" href="#_2-1-创建命名空间"><span>2.1 创建命名空间</span></a></h3><blockquote><p>注意：在执行命名空间创建操作之前，需验证所指定的命名空间名称在 Kubernetes 集群中尚未被使用。如果命名空间已存在，创建命令将无法执行，可能导致部署过程中的错误。</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-查看命名空间" tabindex="-1"><a class="header-anchor" href="#_2-2-查看命名空间"><span>2.2 查看命名空间</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-创建-persistentvolume-pv" tabindex="-1"><a class="header-anchor" href="#_3-创建-persistentvolume-pv"><span>3. 创建 PersistentVolume (PV)</span></a></h2><h3 id="_3-1-创建-pv-配置文件" tabindex="-1"><a class="header-anchor" href="#_3-1-创建-pv-配置文件"><span>3.1 创建 PV 配置文件</span></a></h3><p>PV用于持久化存储IoTDB的ConfigNode 和 DataNode的数据，有几个节点就要创建几个PV。</p><blockquote><p>注：1个ConfigNode和1个DataNode 算2个节点，需要2个PV。</p></blockquote><p>以 3ConfigNode、3DataNode 为例：</p><ol><li>创建 <code>pv.yaml</code> 文件，并复制六份，分别重命名为 <code>pv01.yaml</code> ～ <code>pv06.yaml</code>。</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;">#可新建个文件夹放yaml文件</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">#创建 pv.yaml 文件语句</span></span>
<span class="line"><span style="color:#61AFEF;">touch</span><span style="color:#98C379;"> pv.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>修改每个文件中的 <code>name</code> 和 <code>path</code> 以确保一致性。</li></ol><p><strong>pv.yaml 示例：</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># pv.yaml</span></span>
<span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">PersistentVolume</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">iotdb-pv-01</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  capacity</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    storage</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;"> # 存储容量</span></span>
<span class="line"><span style="color:#E06C75;">  accessModes</span><span style="color:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;"># 访问模式</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#98C379;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#E06C75;">  persistentVolumeReclaimPolicy</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Retain</span><span style="color:#7F848E;font-style:italic;"> # 回收策略</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # 存储类名称，如果使用本地静态存储storageClassName 不用配置，如果使用动态存储必需设置此项</span></span>
<span class="line"><span style="color:#E06C75;">  storageClassName</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">local-storage</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # 根据你的存储类型添加相应的配置</span></span>
<span class="line"><span style="color:#E06C75;">  hostPath</span><span style="color:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;"># 如果是使用本地路径</span></span>
<span class="line"><span style="color:#E06C75;">    path</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">/data/k8s-data/iotdb-pv-01</span></span>
<span class="line"><span style="color:#E06C75;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">DirectoryOrCreate</span><span style="color:#7F848E;font-style:italic;">  # 这行不配置就要手动创建文件夹</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-应用-pv-配置" tabindex="-1"><a class="header-anchor" href="#_3-2-应用-pv-配置"><span>3.2 应用 PV 配置</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pv01.yaml</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pv-02.yaml</span></span>
<span class="line"><span style="color:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-查看-pv" tabindex="-1"><a class="header-anchor" href="#_3-3-查看-pv"><span>3.3 查看 PV</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes01.png" alt="" style="width:70%;"><h3 id="_3-4-手动创建文件夹" tabindex="-1"><a class="header-anchor" href="#_3-4-手动创建文件夹"><span>3.4 手动创建文件夹</span></a></h3><blockquote><p>如果yaml里的hostPath-type未配置，需要手动创建对应的文件夹</p></blockquote><p>在所有 Kubernetes 节点上创建对应的文件夹：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> /data/k8s-data/iotdb-pv-01</span></span>
<span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> /data/k8s-data/iotdb-pv-02</span></span>
<span class="line"><span style="color:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-安装-helm" tabindex="-1"><a class="header-anchor" href="#_4-安装-helm"><span>4. 安装 Helm</span></a></h2><p>安装Helm步骤请参考<a href="https://helm.sh/zh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm官网</a></p><h2 id="_5-配置iotdb的helm-chart" tabindex="-1"><a class="header-anchor" href="#_5-配置iotdb的helm-chart"><span>5. 配置IoTDB的Helm Chart</span></a></h2><h3 id="_5-1-克隆-iotdb-kubernetes-部署代码" tabindex="-1"><a class="header-anchor" href="#_5-1-克隆-iotdb-kubernetes-部署代码"><span>5.1 克隆 IoTDB Kubernetes 部署代码</span></a></h3><p>请联系天谋工作人员获取IoTDB的Helm Chart</p><p>如果遇到代理问题，取消代理设置：</p><blockquote><p>git clone报错如下，说明是配置了代理，需要把代理关掉 fatal: unable to access &#39;<a href="https://gitlab.timecho.com/r-d/db/iotdb-cluster-k8s.git/" target="_blank" rel="noopener noreferrer">https://gitlab.timecho.com/r-d/db/iotdb-cluster-k8s.git/</a>&#39;: gnutls_handshake() failed: The TLS connection was non-properly terminated.</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#56B6C2;">unset</span><span style="color:#98C379;"> HTTPS_PROXY</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-修改-yaml-文件" tabindex="-1"><a class="header-anchor" href="#_5-2-修改-yaml-文件"><span>5.2 修改 YAML 文件</span></a></h3><blockquote><p>确保使用的是支持的版本 &gt;=1.3.3.2</p></blockquote><p><strong>values.yaml 示例：</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E06C75;">nameOverride</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;iotdb&quot;</span><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#E06C75;">fullnameOverride</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;iotdb&quot;</span><span style="color:#7F848E;font-style:italic;">   #软件安装后的名称</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  repository</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nexus.infra.timecho.com:8143/timecho/iotdb-enterprise</span></span>
<span class="line"><span style="color:#E06C75;">  pullPolicy</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">IfNotPresent</span></span>
<span class="line"><span style="color:#E06C75;">  tag</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1.3.3.2-standalone</span><span style="color:#7F848E;font-style:italic;">    #软件所用的仓库和版本</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">storage</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 存储类名称，如果使用本地静态存储storageClassName 不用配置，如果使用动态存储必需设置此项</span></span>
<span class="line"><span style="color:#E06C75;">  className</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">local-storage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">datanode</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">datanode</span></span>
<span class="line"><span style="color:#E06C75;">  nodeCount</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#7F848E;font-style:italic;">        #datanode的节点数量</span></span>
<span class="line"><span style="color:#E06C75;">  enableRestService</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;">  storageCapacity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;">       #datanode的可用空间大小</span></span>
<span class="line"><span style="color:#E06C75;">  resources</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    requests</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">2Gi</span><span style="color:#7F848E;font-style:italic;">    #datanode的内存初始化大小</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">     #datanode的CPU初始化大小</span></span>
<span class="line"><span style="color:#E06C75;">    limits</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">4Gi</span><span style="color:#7F848E;font-style:italic;">    #datanode的最大内存大小</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">     #datanode的最大CPU大小</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">confignode</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">confignode</span></span>
<span class="line"><span style="color:#E06C75;">  nodeCount</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#7F848E;font-style:italic;">      #confignode的节点数量</span></span>
<span class="line"><span style="color:#E06C75;">  storageCapacity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;">      #confignode的可用空间大小</span></span>
<span class="line"><span style="color:#E06C75;">  resources</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    requests</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">512Mi</span><span style="color:#7F848E;font-style:italic;">    #confignode的内存初始化大小</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">      #confignode的CPU初始化大小</span></span>
<span class="line"><span style="color:#E06C75;">    limits</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1024Mi</span><span style="color:#7F848E;font-style:italic;">   #confignode的最大内存大小</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">2000m</span><span style="color:#7F848E;font-style:italic;">     #confignode的最大CPU大小</span></span>
<span class="line"><span style="color:#E06C75;">  configNodeConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.ratis.RatisConsensus</span></span>
<span class="line"><span style="color:#E06C75;">  schemaReplicationFactor</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span></span>
<span class="line"><span style="color:#E06C75;">  schemaRegionConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.ratis.RatisConsensus</span></span>
<span class="line"><span style="color:#E06C75;">  dataReplicationFactor</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span></span>
<span class="line"><span style="color:#E06C75;">  dataRegionConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.iot.IoTConsensus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-配置私库信息或预先使用ctr拉取镜像" tabindex="-1"><a class="header-anchor" href="#_6-配置私库信息或预先使用ctr拉取镜像"><span>6. 配置私库信息或预先使用ctr拉取镜像</span></a></h2><p>在k8s上配置私有仓库的信息，为下一步helm install的前置步骤。</p><p>方案一即在helm insta时拉取可用的iotdb镜像，方案二则是提前将可用的iotdb镜像导入到containerd里。</p><h3 id="_6-1-【方案一】从私有仓库拉取镜像" tabindex="-1"><a class="header-anchor" href="#_6-1-【方案一】从私有仓库拉取镜像"><span>6.1 【方案一】从私有仓库拉取镜像</span></a></h3><h4 id="_6-1-1-创建secret-使k8s可访问iotdb-helm的私有仓库" tabindex="-1"><a class="header-anchor" href="#_6-1-1-创建secret-使k8s可访问iotdb-helm的私有仓库"><span>6.1.1 创建secret 使k8s可访问iotdb-helm的私有仓库</span></a></h4><p>下文中“xxxxxx”表示IoTDB私有仓库的账号、密码、邮箱。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 注意 单引号</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> docker-registry</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-server=</span><span style="color:#98C379;">&#39;nexus.infra.timecho.com:8143&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-username=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-password=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-email=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看secret</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看并输出为yaml</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> --output=yaml</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看并解密</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> --output=</span><span style="color:#98C379;">&quot;jsonpath={.data.\\.dockerconfigjson}&quot;</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">base64</span><span style="color:#D19A66;"> --decode</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-1-2-将secret作为一个patch加载到命名空间iotdb-ns" tabindex="-1"><a class="header-anchor" href="#_6-1-2-将secret作为一个patch加载到命名空间iotdb-ns"><span>6.1.2 将secret作为一个patch加载到命名空间iotdb-ns</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 添加一个patch，使该命名空间增加登陆nexus的登陆信息</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> patch</span><span style="color:#98C379;"> serviceaccount</span><span style="color:#98C379;"> default</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> &#39;{&quot;imagePullSecrets&quot;: [{&quot;name&quot;: &quot;timecho-nexus&quot;}]}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看命名空间的该条信息</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> serviceaccounts</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-【方案二】导入镜像" tabindex="-1"><a class="header-anchor" href="#_6-2-【方案二】导入镜像"><span>6.2 【方案二】导入镜像</span></a></h3><p>该步骤用于客户无法连接私库的场景，需要联系公司实施同事辅助准备。</p><h4 id="_6-2-1-拉取并导出镜像" tabindex="-1"><a class="header-anchor" href="#_6-2-1-拉取并导出镜像"><span>6.2.1 拉取并导出镜像：</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> pull</span><span style="color:#D19A66;"> --user</span><span style="color:#98C379;"> xxxxxxxx</span><span style="color:#98C379;"> nexus.infra.timecho.com:8143/timecho/iotdb-enterprise:1.3.3.2-standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_6-2-2-查看并导出镜像" tabindex="-1"><a class="header-anchor" href="#_6-2-2-查看并导出镜像"><span>6.2.2 查看并导出镜像：</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 查看</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> ls</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 导出</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> export</span><span style="color:#98C379;"> iotdb-enterprise:1.3.3.2-standalone.tar</span><span style="color:#98C379;"> nexus.infra.timecho.com:8143/timecho/iotdb-enterprise:1.3.3.2-standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-3-导入到k8s的namespace下" tabindex="-1"><a class="header-anchor" href="#_6-2-3-导入到k8s的namespace下"><span>6.2.3 导入到k8s的namespace下：</span></a></h4><blockquote><p>注意，k8s.io为示例环境中k8s的ctr的命名空间，导入到其他命名空间是不行的</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 导入到k8s的namespace下</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> k8s.io</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> import</span><span style="color:#98C379;"> iotdb-enterprise:1.3.3.2-standalone.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-4-查看镜像" tabindex="-1"><a class="header-anchor" href="#_6-2-4-查看镜像"><span>6.2.4 查看镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#D19A66;"> --namespace</span><span style="color:#98C379;"> k8s.io</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> list</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> 1.3.3.2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_7-安装-iotdb" tabindex="-1"><a class="header-anchor" href="#_7-安装-iotdb"><span>7. 安装 IoTDB</span></a></h2><h3 id="_7-1-安装-iotdb" tabindex="-1"><a class="header-anchor" href="#_7-1-安装-iotdb"><span>7.1 安装 IoTDB</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 进入文件夹</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> iotdb-cluster-k8s/helm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 安装iotdb</span></span>
<span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> ./</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-查看-helm-安装列表" tabindex="-1"><a class="header-anchor" href="#_7-2-查看-helm-安装列表"><span>7.2 查看 Helm 安装列表</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># helm list</span></span>
<span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> list</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-查看-pods" tabindex="-1"><a class="header-anchor" href="#_7-3-查看-pods"><span>7.3 查看 Pods</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 查看 iotdb的pods</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>执行命令后，输出了带有confignode和datanode标识的各3个Pods，，总共6个Pods，即表明安装成功；需要注意的是，并非所有Pods都处于Running状态，未激活的datanode可能会持续重启，但在激活后将恢复正常。</p><h3 id="_7-4-发现故障的排除方式" tabindex="-1"><a class="header-anchor" href="#_7-4-发现故障的排除方式"><span>7.4 发现故障的排除方式</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># 查看k8s的创建log</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> events</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">watch</span><span style="color:#98C379;"> kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> events</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 获取详细信息</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> datanode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 查看confignode日志</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> logs</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-激活-iotdb" tabindex="-1"><a class="header-anchor" href="#_8-激活-iotdb"><span>8. 激活 IoTDB</span></a></h2><h3 id="_8-1-方案1-直接在-pod-中激活-最快捷" tabindex="-1"><a class="header-anchor" href="#_8-1-方案1-直接在-pod-中激活-最快捷"><span>8.1 方案1：直接在 Pod 中激活（最快捷）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-1</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-2</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 拿到机器码后进行激活</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-方案2-进入confignode的容器中激活" tabindex="-1"><a class="header-anchor" href="#_8-2-方案2-进入confignode的容器中激活"><span>8.2 方案2：进入confignode的容器中激活</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> /iotdb/sbin</span></span>
<span class="line"><span style="color:#61AFEF;">/bin/bash</span><span style="color:#98C379;"> start-activate.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 拿到机器码后进行激活</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 退出容器</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-3-方案3-手动激活" tabindex="-1"><a class="header-anchor" href="#_8-3-方案3-手动激活"><span>8.3 方案3：手动激活</span></a></h3><ol><li>查看 ConfigNode 详细信息，确定所在节点：</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Node:&quot;</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Path:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结果示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Node:          a87/172.20.31.87</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Path:          /data/k8s-data/env/confignode/.env</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>查看 PVC 并找到 ConfigNode 对应的 Volume，确定所在路径：</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pvc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> &quot;confignode-0&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结果示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># map-confignode-confignode-0   Bound    iotdb-pv-04   10Gi       RWO            local-storage   &lt;unset&gt;                 8h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 如果要查看多个confignode，使用如下：</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> i</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> {</span><span style="color:#61AFEF;">0..2}</span><span style="color:#ABB2BF;">; </span><span style="color:#C678DD;">do</span><span style="color:#56B6C2;"> echo</span><span style="color:#98C379;"> confignode-</span><span style="color:#E06C75;">$i</span><span style="color:#ABB2BF;">;</span><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-</span><span style="color:#ABB2BF;">\${</span><span style="color:#E06C75;">i</span><span style="color:#ABB2BF;">} </span><span style="color:#D19A66;">-n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Node:&quot;</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Path:&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#56B6C2;">echo</span><span style="color:#98C379;"> &quot;----&quot;</span><span style="color:#ABB2BF;">; </span><span style="color:#C678DD;">done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>查看对应 Volume 的详细信息，确定物理目录的位置：</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pv</span><span style="color:#98C379;"> iotdb-pv-04</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> &quot;Path:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结果示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Path:          /data/k8s-data/iotdb-pv-04</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>从对应节点的对应目录下找到 system-info 文件，使用该 system-info 作为机器码生成激活码，并在同级目录新建文件 license，将激活码写入到该文件。</li></ol><h2 id="_9-验证-iotdb" tabindex="-1"><a class="header-anchor" href="#_9-验证-iotdb"><span>9. 验证 IoTDB</span></a></h2><h3 id="_9-1-查看命名空间内的-pods-状态" tabindex="-1"><a class="header-anchor" href="#_9-1-查看命名空间内的-pods-状态"><span>9.1 查看命名空间内的 Pods 状态</span></a></h3><p>查看iotdb-ns命名空间内的IP、状态等信息，确定全部运行正常</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结果示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME           READY   STATUS    RESTARTS         AGE   IP             NODE   NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-0   1/1     Running   0                75m   10.20.187.14   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-1   1/1     Running   0                75m   10.20.191.75   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-2   1/1     Running   0                75m   10.20.187.16   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-0     1/1     Running   10 (5m54s ago)   75m   10.20.191.74   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-1     1/1     Running   10 (5m42s ago)   75m   10.20.187.15   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-2     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-查看命名空间内的端口映射情况" tabindex="-1"><a class="header-anchor" href="#_9-2-查看命名空间内的端口映射情况"><span>9.2 查看命名空间内的端口映射情况</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> svc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># 结果示例：</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME             TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-svc   NodePort       10.10.226.151   &lt;none&gt;        80:31026/TCP     7d8h</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-svc     NodePort       10.10.194.225   &lt;none&gt;        6667:31563/TCP   7d8h</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># jdbc-balancer    LoadBalancer   10.10.191.209   &lt;pending&gt;     6667:31895/TCP   7d8h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-在任意服务器启动-cli-脚本验证-iotdb-集群状态" tabindex="-1"><a class="header-anchor" href="#_9-3-在任意服务器启动-cli-脚本验证-iotdb-集群状态"><span>9.3 在任意服务器启动 CLI 脚本验证 IoTDB 集群状态</span></a></h3><p>端口即jdbc-balancer的端口，服务器为k8s任意节点的IP</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.86</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span>
<span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.87</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span>
<span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.88</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes02.png" alt="" style="width:70%;"><h2 id="_10-扩容" tabindex="-1"><a class="header-anchor" href="#_10-扩容"><span>10. 扩容</span></a></h2><h3 id="_10-1-新增pv" tabindex="-1"><a class="header-anchor" href="#_10-1-新增pv"><span>10.1 新增pv</span></a></h3><p>新增pv，必须有可用的pv才可以扩容。</p><img src="https://alioss.timecho.com/docs/img/Kubernetes03.png" alt="" style="width:70%;"><p><strong>注意：DataNode重启后无法加入集群</strong></p><p><strong>原因</strong>：配置了静态存储的 hostPath 模式，并通过脚本修改了 <code>iotdb-system.properties</code> 文件，将 <code>dn_data_dirs</code> 设为 <code>/iotdb6/iotdb_data,/iotdb7/iotdb_data</code>，但未将默认存储路径 <code>/iotdb/data</code> 进行外挂，导致重启时数据丢失。</p><p><strong>解决方案</strong>：是将 <code>/iotdb/data</code> 目录也进行外挂操作，且 ConfigNode 和 DataNode 均需如此设置，以确保数据完整性和集群稳定性。</p><h3 id="_10-2-扩容confignode" tabindex="-1"><a class="header-anchor" href="#_10-2-扩容confignode"><span>10.2 扩容confignode</span></a></h3><p>示例：3 confignode 扩容为 4 confignode</p><p>修改iotdb-cluster-k8s/helm的values.yaml文件，将confignode的3改成4</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> upgrade</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> .</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes04.png" alt="" style="width:70%;"><h3 id="_10-3-扩容datanode" tabindex="-1"><a class="header-anchor" href="#_10-3-扩容datanode"><span>10.3 扩容datanode</span></a></h3><p>示例：3 datanode 扩容为 4 datanode</p><p>修改iotdb-cluster-k8s/helm的values.yaml文件，将datanode的3改成4</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> upgrade</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> .</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-4-验证iotdb状态" tabindex="-1"><a class="header-anchor" href="#_10-4-验证iotdb状态"><span>10.4 验证IoTDB状态</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME           READY   STATUS    RESTARTS         AGE   IP             NODE   NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-0   1/1     Running   0                75m   10.20.187.14   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-1   1/1     Running   0                75m   10.20.191.75   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-2   1/1     Running   0                75m   10.20.187.16   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-0     1/1     Running   10 (5m54s ago)   75m   10.20.191.74   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-1     1/1     Running   10 (5m42s ago)   75m   10.20.187.15   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-2     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-3     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,114)]))}const c=n(o,[["render",t],["__file","Kubernetes_apache.html.vue"]]),r=JSON.parse('{"path":"/zh/UserGuide/V2.0.1/Tree/Ecosystem-Integration/Kubernetes_apache.html","title":"Kubernetes","lang":"zh-CN","frontmatter":{"description":"Kubernetes 1. 环境准备 1.1 准备 Kubernetes 集群 确保拥有一个可用的 Kubernetes 集群（建议最低版本：Kubernetes 1.24），作为部署 IoTDB 集群的基础。 Kubernetes 版本要求：建议版本为 Kubernetes 1.24及以上 IoTDB版本要求：不能低于v1.3.3.2 2. 创建命名...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://iotdb.apache.org/UserGuide/V2.0.1/Tree/Ecosystem-Integration/Kubernetes_apache.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/zh/UserGuide/V2.0.1/Tree/Ecosystem-Integration/Kubernetes_apache.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:title","content":"Kubernetes"}],["meta",{"property":"og:description","content":"Kubernetes 1. 环境准备 1.1 准备 Kubernetes 集群 确保拥有一个可用的 Kubernetes 集群（建议最低版本：Kubernetes 1.24），作为部署 IoTDB 集群的基础。 Kubernetes 版本要求：建议版本为 Kubernetes 1.24及以上 IoTDB版本要求：不能低于v1.3.3.2 2. 创建命名..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-01-12T13:55:54.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-12T13:55:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Kubernetes\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-12T13:55:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"1. 环境准备","slug":"_1-环境准备","link":"#_1-环境准备","children":[{"level":3,"title":"1.1 准备 Kubernetes 集群","slug":"_1-1-准备-kubernetes-集群","link":"#_1-1-准备-kubernetes-集群","children":[]}]},{"level":2,"title":"2. 创建命名空间","slug":"_2-创建命名空间","link":"#_2-创建命名空间","children":[{"level":3,"title":"2.1 创建命名空间","slug":"_2-1-创建命名空间","link":"#_2-1-创建命名空间","children":[]},{"level":3,"title":"2.2 查看命名空间","slug":"_2-2-查看命名空间","link":"#_2-2-查看命名空间","children":[]}]},{"level":2,"title":"3. 创建 PersistentVolume (PV)","slug":"_3-创建-persistentvolume-pv","link":"#_3-创建-persistentvolume-pv","children":[{"level":3,"title":"3.1 创建 PV 配置文件","slug":"_3-1-创建-pv-配置文件","link":"#_3-1-创建-pv-配置文件","children":[]},{"level":3,"title":"3.2 应用 PV 配置","slug":"_3-2-应用-pv-配置","link":"#_3-2-应用-pv-配置","children":[]},{"level":3,"title":"3.3 查看 PV","slug":"_3-3-查看-pv","link":"#_3-3-查看-pv","children":[]},{"level":3,"title":"3.4 手动创建文件夹","slug":"_3-4-手动创建文件夹","link":"#_3-4-手动创建文件夹","children":[]}]},{"level":2,"title":"4. 安装 Helm","slug":"_4-安装-helm","link":"#_4-安装-helm","children":[]},{"level":2,"title":"5. 配置IoTDB的Helm Chart","slug":"_5-配置iotdb的helm-chart","link":"#_5-配置iotdb的helm-chart","children":[{"level":3,"title":"5.1 克隆 IoTDB Kubernetes 部署代码","slug":"_5-1-克隆-iotdb-kubernetes-部署代码","link":"#_5-1-克隆-iotdb-kubernetes-部署代码","children":[]},{"level":3,"title":"5.2 修改 YAML 文件","slug":"_5-2-修改-yaml-文件","link":"#_5-2-修改-yaml-文件","children":[]}]},{"level":2,"title":"6. 配置私库信息或预先使用ctr拉取镜像","slug":"_6-配置私库信息或预先使用ctr拉取镜像","link":"#_6-配置私库信息或预先使用ctr拉取镜像","children":[{"level":3,"title":"6.1 【方案一】从私有仓库拉取镜像","slug":"_6-1-【方案一】从私有仓库拉取镜像","link":"#_6-1-【方案一】从私有仓库拉取镜像","children":[]},{"level":3,"title":"6.2 【方案二】导入镜像","slug":"_6-2-【方案二】导入镜像","link":"#_6-2-【方案二】导入镜像","children":[]}]},{"level":2,"title":"7. 安装 IoTDB","slug":"_7-安装-iotdb","link":"#_7-安装-iotdb","children":[{"level":3,"title":"7.1 安装 IoTDB","slug":"_7-1-安装-iotdb","link":"#_7-1-安装-iotdb","children":[]},{"level":3,"title":"7.2 查看 Helm 安装列表","slug":"_7-2-查看-helm-安装列表","link":"#_7-2-查看-helm-安装列表","children":[]},{"level":3,"title":"7.3 查看 Pods","slug":"_7-3-查看-pods","link":"#_7-3-查看-pods","children":[]},{"level":3,"title":"7.4 发现故障的排除方式","slug":"_7-4-发现故障的排除方式","link":"#_7-4-发现故障的排除方式","children":[]}]},{"level":2,"title":"8. 激活 IoTDB","slug":"_8-激活-iotdb","link":"#_8-激活-iotdb","children":[{"level":3,"title":"8.1 方案1：直接在 Pod 中激活（最快捷）","slug":"_8-1-方案1-直接在-pod-中激活-最快捷","link":"#_8-1-方案1-直接在-pod-中激活-最快捷","children":[]},{"level":3,"title":"8.2 方案2：进入confignode的容器中激活","slug":"_8-2-方案2-进入confignode的容器中激活","link":"#_8-2-方案2-进入confignode的容器中激活","children":[]},{"level":3,"title":"8.3 方案3：手动激活","slug":"_8-3-方案3-手动激活","link":"#_8-3-方案3-手动激活","children":[]}]},{"level":2,"title":"9. 验证 IoTDB","slug":"_9-验证-iotdb","link":"#_9-验证-iotdb","children":[{"level":3,"title":"9.1 查看命名空间内的 Pods 状态","slug":"_9-1-查看命名空间内的-pods-状态","link":"#_9-1-查看命名空间内的-pods-状态","children":[]},{"level":3,"title":"9.2 查看命名空间内的端口映射情况","slug":"_9-2-查看命名空间内的端口映射情况","link":"#_9-2-查看命名空间内的端口映射情况","children":[]},{"level":3,"title":"9.3 在任意服务器启动 CLI 脚本验证 IoTDB 集群状态","slug":"_9-3-在任意服务器启动-cli-脚本验证-iotdb-集群状态","link":"#_9-3-在任意服务器启动-cli-脚本验证-iotdb-集群状态","children":[]}]},{"level":2,"title":"10. 扩容","slug":"_10-扩容","link":"#_10-扩容","children":[{"level":3,"title":"10.1 新增pv","slug":"_10-1-新增pv","link":"#_10-1-新增pv","children":[]},{"level":3,"title":"10.2 扩容confignode","slug":"_10-2-扩容confignode","link":"#_10-2-扩容confignode","children":[]},{"level":3,"title":"10.3 扩容datanode","slug":"_10-3-扩容datanode","link":"#_10-3-扩容datanode","children":[]},{"level":3,"title":"10.4 验证IoTDB状态","slug":"_10-4-验证iotdb状态","link":"#_10-4-验证iotdb状态","children":[]}]}],"git":{"createdTime":1736690154000,"updatedTime":1736690154000,"contributors":[{"name":"W1y1r","username":"W1y1r","email":"150988475+W1y1r@users.noreply.github.com","commits":1,"url":"https://github.com/W1y1r"}]},"readingTime":{"minutes":8.22,"words":2466},"filePathRelative":"zh/UserGuide/V2.0.1/Tree/Ecosystem-Integration/Kubernetes_apache.md","localizedDate":"2025年1月12日","autoDesc":true}');export{c as comp,r as data};
