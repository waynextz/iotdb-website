import{_ as e,c as a,b as n,o as l}from"./app-CLygX6ac.js";const o={};function t(i,s){return l(),a("div",null,s[0]||(s[0]=[n(`<h1 id="kubernetes" tabindex="-1"><a class="header-anchor" href="#kubernetes"><span>Kubernetes</span></a></h1><h2 id="_1-environment-preparation" tabindex="-1"><a class="header-anchor" href="#_1-environment-preparation"><span>1. Environment Preparation</span></a></h2><h3 id="_1-1-prepare-a-kubernetes-cluster" tabindex="-1"><a class="header-anchor" href="#_1-1-prepare-a-kubernetes-cluster"><span>1.1 Prepare a Kubernetes Cluster</span></a></h3><p>Ensure that you have an available Kubernetes cluster (minimum recommended version: Kubernetes 1.24) as the foundation for deploying the IoTDB cluster.</p><p>Kubernetes Version Requirement: The recommended version is Kubernetes 1.24 or above.</p><p>IoTDB Version Requirement: The version of IoTDB must not be lower than v1.3.3.</p><h2 id="_2-create-namespace" tabindex="-1"><a class="header-anchor" href="#_2-create-namespace"><span>2. Create Namespace</span></a></h2><h3 id="_2-1-create-namespace" tabindex="-1"><a class="header-anchor" href="#_2-1-create-namespace"><span>2.1 Create Namespace</span></a></h3><blockquote><p>Note: Before executing the namespace creation operation, verify that the specified namespace name has not been used in the Kubernetes cluster. If the namespace already exists, the creation command will fail, which may lead to errors during the deployment process.</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> ns</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-2-view-namespace" tabindex="-1"><a class="header-anchor" href="#_2-2-view-namespace"><span>2.2 View Namespace</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3-create-persistentvolume-pv" tabindex="-1"><a class="header-anchor" href="#_3-create-persistentvolume-pv"><span>3. Create PersistentVolume (PV)</span></a></h2><h3 id="_3-1-create-pv-configuration-file" tabindex="-1"><a class="header-anchor" href="#_3-1-create-pv-configuration-file"><span>3.1 Create PV Configuration File</span></a></h3><p>PV is used for persistent storage of IoTDB&#39;s ConfigNode and DataNode data. You need to create one PV for each node.</p><blockquote><p>Note: One ConfigNode and one DataNode count as two nodes, requiring two PVs.</p></blockquote><p>For example, with 3 ConfigNodes and 3 DataNodes:</p><ol><li>Create a <code>pv.yaml</code> file and make six copies, renaming them to <code>pv01.yaml</code> through <code>pv06.yaml</code>.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Create a directory to store YAML files</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Create pv.yaml file</span></span>
<span class="line"><span style="color:#61AFEF;">touch</span><span style="color:#98C379;"> pv.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Modify the <code>name</code> and <code>path</code> in each file to ensure consistency.</li></ol><p><strong>pv.yaml Example：</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># pv.yaml</span></span>
<span class="line"><span style="color:#E06C75;">apiVersion</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">v1</span></span>
<span class="line"><span style="color:#E06C75;">kind</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">PersistentVolume</span></span>
<span class="line"><span style="color:#E06C75;">metadata</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">iotdb-pv-01</span></span>
<span class="line"><span style="color:#E06C75;">spec</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  capacity</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    storage</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;"> # Storage capacity</span></span>
<span class="line"><span style="color:#E06C75;">  accessModes</span><span style="color:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;"># Access modes</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#98C379;">ReadWriteOnce</span></span>
<span class="line"><span style="color:#E06C75;">  persistentVolumeReclaimPolicy</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">Retain</span><span style="color:#7F848E;font-style:italic;"> # Reclaim policy</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # Storage class name, if using local static storage, do not configure; if using dynamic storage, this must be set</span></span>
<span class="line"><span style="color:#E06C75;">  storageClassName</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">local-storage</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # Add the corresponding configuration based on your storage type</span></span>
<span class="line"><span style="color:#E06C75;">  hostPath</span><span style="color:#ABB2BF;">: </span><span style="color:#7F848E;font-style:italic;"># If using a local path</span></span>
<span class="line"><span style="color:#E06C75;">    path</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">/data/k8s-data/iotdb-pv-01</span></span>
<span class="line"><span style="color:#E06C75;">    type</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">DirectoryOrCreate</span><span style="color:#7F848E;font-style:italic;">  # If this line is not configured, you need to manually create the directory</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-apply-pv-configuration" tabindex="-1"><a class="header-anchor" href="#_3-2-apply-pv-configuration"><span>3.2 Apply PV Configuration</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pv01.yaml</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> apply</span><span style="color:#D19A66;"> -f</span><span style="color:#98C379;"> pv-02.yaml</span></span>
<span class="line"><span style="color:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-view-pv" tabindex="-1"><a class="header-anchor" href="#_3-3-view-pv"><span>3.3 View PV</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pv</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes01.png" alt="" style="width:70%;"><h3 id="_3-4-manually-create-directories" tabindex="-1"><a class="header-anchor" href="#_3-4-manually-create-directories"><span>3.4 Manually Create Directories</span></a></h3><blockquote><p>Note: If the type in the hostPath of the YAML file is not configured, you need to manually create the corresponding directories.</p></blockquote><p>Create the corresponding directories on all Kubernetes nodes:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> /data/k8s-data/iotdb-pv-01</span></span>
<span class="line"><span style="color:#61AFEF;">mkdir</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> /data/k8s-data/iotdb-pv-02</span></span>
<span class="line"><span style="color:#56B6C2;">...</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-install-helm" tabindex="-1"><a class="header-anchor" href="#_4-install-helm"><span>4. Install Helm</span></a></h2><p>For installation steps, please refer to the<a href="https://helm.sh/zh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm Official Website.</a></p><h2 id="_5-configure-iotdb-helm-chart" tabindex="-1"><a class="header-anchor" href="#_5-configure-iotdb-helm-chart"><span>5. Configure IoTDB Helm Chart</span></a></h2><h3 id="_5-1-clone-iotdb-kubernetes-deployment-code" tabindex="-1"><a class="header-anchor" href="#_5-1-clone-iotdb-kubernetes-deployment-code"><span>5.1 Clone IoTDB Kubernetes Deployment Code</span></a></h3><p>Please contact timechodb staff to obtain the IoTDB Helm Chart. If you encounter proxy issues, disable the proxy settings:</p><p>If encountering proxy issues, cancel proxy settings:</p><blockquote><p>The git clone error is as follows, indicating that the proxy has been configured and needs to be turned off fatal: unable to access &#39;<a href="https://gitlab.timecho.com/r-d/db/iotdb-cluster-k8s.git/" target="_blank" rel="noopener noreferrer">https://gitlab.timecho.com/r-d/db/iotdb-cluster-k8s.git/</a>&#39;: gnutls_handshake() failed: The TLS connection was non-properly terminated.</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#56B6C2;">unset</span><span style="color:#98C379;"> HTTPS_PROXY</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_5-2-modify-yaml-files" tabindex="-1"><a class="header-anchor" href="#_5-2-modify-yaml-files"><span>5.2 Modify YAML Files</span></a></h3><blockquote><p>Ensure that the version used is supported (&gt;=1.3.3.2):</p></blockquote><p><strong>values.yaml Example：</strong></p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#E06C75;">nameOverride</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;iotdb&quot;</span></span>
<span class="line"><span style="color:#E06C75;">fullnameOverride</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&quot;iotdb&quot;</span><span style="color:#7F848E;font-style:italic;">   # Name after installation</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">image</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  repository</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">nexus.infra.timecho.com:8143/timecho/iotdb-enterprise</span></span>
<span class="line"><span style="color:#E06C75;">  pullPolicy</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">IfNotPresent</span></span>
<span class="line"><span style="color:#E06C75;">  tag</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1.3.3.2-standalone</span><span style="color:#7F848E;font-style:italic;">    # Repository and version used</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">storage</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # Storage class name, if using local static storage, do not configure; if using dynamic storage, this must be set</span></span>
<span class="line"><span style="color:#E06C75;">  className</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">local-storage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">datanode</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">datanode</span></span>
<span class="line"><span style="color:#E06C75;">  nodeCount</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#7F848E;font-style:italic;">        # Number of DataNode nodes</span></span>
<span class="line"><span style="color:#E06C75;">  enableRestService</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;">  storageCapacity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;">       # Available space for DataNode</span></span>
<span class="line"><span style="color:#E06C75;">  resources</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    requests</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">2Gi</span><span style="color:#7F848E;font-style:italic;">    # Initial memory size for DataNode</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">     # Initial CPU size for DataNode</span></span>
<span class="line"><span style="color:#E06C75;">    limits</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">4Gi</span><span style="color:#7F848E;font-style:italic;">    # Maximum memory size for DataNode</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">     # Maximum CPU size for DataNode</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">confignode</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">confignode</span></span>
<span class="line"><span style="color:#E06C75;">  nodeCount</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span><span style="color:#7F848E;font-style:italic;">      # Number of ConfigNode nodes</span></span>
<span class="line"><span style="color:#E06C75;">  storageCapacity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10Gi</span><span style="color:#7F848E;font-style:italic;">      # Available space for ConfigNode</span></span>
<span class="line"><span style="color:#E06C75;">  resources</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    requests</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">512Mi</span><span style="color:#7F848E;font-style:italic;">    # Initial memory size for ConfigNode</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1000m</span><span style="color:#7F848E;font-style:italic;">      # Initial CPU size for ConfigNode</span></span>
<span class="line"><span style="color:#E06C75;">    limits</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      memory</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1024Mi</span><span style="color:#7F848E;font-style:italic;">   # Maximum memory size for ConfigNode</span></span>
<span class="line"><span style="color:#E06C75;">      cpu</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">2000m</span><span style="color:#7F848E;font-style:italic;">     # Maximum CPU size for ConfigNode</span></span>
<span class="line"><span style="color:#E06C75;">  configNodeConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.ratis.RatisConsensus</span></span>
<span class="line"><span style="color:#E06C75;">  schemaReplicationFactor</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">3</span></span>
<span class="line"><span style="color:#E06C75;">  schemaRegionConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.ratis.RatisConsensus</span></span>
<span class="line"><span style="color:#E06C75;">  dataReplicationFactor</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">2</span></span>
<span class="line"><span style="color:#E06C75;">  dataRegionConsensusProtocolClass</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">org.apache.iotdb.consensus.iot.IoTConsensus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-configure-private-repository-information-or-pre-pull-images" tabindex="-1"><a class="header-anchor" href="#_6-configure-private-repository-information-or-pre-pull-images"><span>6. Configure Private Repository Information or Pre-Pull Images</span></a></h2><p>Configure private repository information on k8s as a prerequisite for the next helm install step.</p><p>Option one is to pull the available iotdb images during helm insta, while option two is to import the available iotdb images into containerd in advance.</p><h3 id="_6-1-option-1-pull-image-from-private-repository" tabindex="-1"><a class="header-anchor" href="#_6-1-option-1-pull-image-from-private-repository"><span>6.1 [Option 1] Pull Image from Private Repository</span></a></h3><h4 id="_6-1-1-create-a-secret-to-allow-k8s-to-access-the-iotdb-helm-private-repository" tabindex="-1"><a class="header-anchor" href="#_6-1-1-create-a-secret-to-allow-k8s-to-access-the-iotdb-helm-private-repository"><span>6.1.1 Create a Secret to Allow k8s to Access the IoTDB Helm Private Repository</span></a></h4><p>Replace xxxxxx with the IoTDB private repository account, password, and email.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Note the single quotes</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> create</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> docker-registry</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-server=</span><span style="color:#98C379;">&#39;nexus.infra.timecho.com:8143&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-username=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-password=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  --docker-email=</span><span style="color:#98C379;">&#39;xxxxxx&#39;</span><span style="color:#56B6C2;"> \\</span></span>
<span class="line"><span style="color:#D19A66;">  -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># View the secret</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># View and output as YAML</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> --output=yaml</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># View and decrypt</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> secret</span><span style="color:#98C379;"> timecho-nexus</span><span style="color:#D19A66;"> --output=</span><span style="color:#98C379;">&quot;jsonpath={.data.\\.dockerconfigjson}&quot;</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">base64</span><span style="color:#D19A66;"> --decode</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-1-2-load-the-secret-as-a-patch-to-the-namespace-iotdb-ns" tabindex="-1"><a class="header-anchor" href="#_6-1-2-load-the-secret-as-a-patch-to-the-namespace-iotdb-ns"><span>6.1.2 Load the Secret as a Patch to the Namespace iotdb-ns</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Add a patch to include login information for nexus in this namespace</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> patch</span><span style="color:#98C379;"> serviceaccount</span><span style="color:#98C379;"> default</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> &#39;{&quot;imagePullSecrets&quot;: [{&quot;name&quot;: &quot;timecho-nexus&quot;}]}&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># View the information in this namespace</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> serviceaccounts</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2-option-2-import-image" tabindex="-1"><a class="header-anchor" href="#_6-2-option-2-import-image"><span>6.2 [Option 2] Import Image</span></a></h3><p>This step is for scenarios where the customer cannot connect to the private repository and requires assistance from company implementation staff.</p><h4 id="_6-2-1-pull-and-export-the-image" tabindex="-1"><a class="header-anchor" href="#_6-2-1-pull-and-export-the-image"><span>6.2.1 Pull and Export the Image:</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> pull</span><span style="color:#D19A66;"> --user</span><span style="color:#98C379;"> xxxxxxxx</span><span style="color:#98C379;"> nexus.infra.timecho.com:8143/timecho/iotdb-enterprise:1.3.3.2-standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_6-2-2-view-and-export-the-image" tabindex="-1"><a class="header-anchor" href="#_6-2-2-view-and-export-the-image"><span>6.2.2 View and Export the Image:</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># View</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> ls</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Export</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> export</span><span style="color:#98C379;"> iotdb-enterprise:1.3.3.2-standalone.tar</span><span style="color:#98C379;"> nexus.infra.timecho.com:8143/timecho/iotdb-enterprise:1.3.3.2-standalone</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-3-import-into-the-k8s-namespace" tabindex="-1"><a class="header-anchor" href="#_6-2-3-import-into-the-k8s-namespace"><span>6.2.3 Import into the k8s Namespace:</span></a></h4><blockquote><p>Note that <a href="http://k8s.io" target="_blank" rel="noopener noreferrer">k8s.io</a> is the namespace for ctr in the example environment; importing to other namespaces will not work.</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Import into the k8s namespace</span></span>
<span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> k8s.io</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> import</span><span style="color:#98C379;"> iotdb-enterprise:1.3.3.2-standalone.tar</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-4-view-the-image" tabindex="-1"><a class="header-anchor" href="#_6-2-4-view-the-image"><span>6.2.4 View the Image:</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">ctr</span><span style="color:#D19A66;"> --namespace</span><span style="color:#98C379;"> k8s.io</span><span style="color:#98C379;"> images</span><span style="color:#98C379;"> list</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> 1.3.3.2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_7-install-iotdb" tabindex="-1"><a class="header-anchor" href="#_7-install-iotdb"><span>7. Install IoTDB</span></a></h2><h3 id="_7-1-install-iotdb" tabindex="-1"><a class="header-anchor" href="#_7-1-install-iotdb"><span>7.1 Install IoTDB</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># Enter the directory</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> iotdb-cluster-k8s/helm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Install IoTDB</span></span>
<span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> install</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> ./</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-view-helm-installation-list" tabindex="-1"><a class="header-anchor" href="#_7-2-view-helm-installation-list"><span>7.2 View Helm Installation List</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># helm list</span></span>
<span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> list</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-view-pods" tabindex="-1"><a class="header-anchor" href="#_7-3-view-pods"><span>7.3 View Pods</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># View IoTDB pods</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>After executing the command, if the output shows 6 Pods with confignode and datanode labels (3 each), it indicates a successful installation. Note that not all Pods may be in the Running state initially; inactive datanode Pods may keep restarting but will normalize after activation.</p><h3 id="_7-4-troubleshooting" tabindex="-1"><a class="header-anchor" href="#_7-4-troubleshooting"><span>7.4 Troubleshooting</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># View k8s creation logs</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> events</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#61AFEF;">watch</span><span style="color:#98C379;"> kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> events</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Get detailed information</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> datanode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># View ConfigNode logs</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> logs</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-activate-iotdb" tabindex="-1"><a class="header-anchor" href="#_8-activate-iotdb"><span>8. Activate IoTDB</span></a></h2><h3 id="_8-1-option-1-activate-directly-in-the-pod-quickest" tabindex="-1"><a class="header-anchor" href="#_8-1-option-1-activate-directly-in-the-pod-quickest"><span>8.1 Option 1: Activate Directly in the Pod (Quickest)</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-1</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-2</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /iotdb/sbin/start-activate.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Obtain the machine code and proceed with activation</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_8-2-option-2-activate-inside-the-confignode-container" tabindex="-1"><a class="header-anchor" href="#_8-2-option-2-activate-inside-the-confignode-container"><span>8.2 Option 2: Activate Inside the ConfigNode Container</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> exec</span><span style="color:#D19A66;"> -it</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> --</span><span style="color:#98C379;"> /bin/bash</span></span>
<span class="line"><span style="color:#56B6C2;">cd</span><span style="color:#98C379;"> /iotdb/sbin</span></span>
<span class="line"><span style="color:#61AFEF;">/bin/bash</span><span style="color:#98C379;"> start-activate.sh</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Obtain the machine code and proceed with activation</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Exit the container</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="option-3-manual-activation" tabindex="-1"><a class="header-anchor" href="#option-3-manual-activation"><span>Option 3: Manual Activation</span></a></h3><ol><li>View ConfigNode details to determine the node:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-0</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Node:&quot;</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Path:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Example output:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Node:          a87/172.20.31.87</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Path:          /data/k8s-data/env/confignode/.env</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>View PVC and find the corresponding Volume for ConfigNode to determine the path:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pvc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> &quot;confignode-0&quot;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Example output:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># map-confignode-confignode-0   Bound    iotdb-pv-04   10Gi       RWO            local-storage   &lt;unset&gt;                 8h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># To view multiple ConfigNodes, use the following:</span></span>
<span class="line"><span style="color:#C678DD;">for</span><span style="color:#E06C75;"> i</span><span style="color:#C678DD;"> in</span><span style="color:#ABB2BF;"> {</span><span style="color:#61AFEF;">0..2}</span><span style="color:#ABB2BF;">; </span><span style="color:#C678DD;">do</span><span style="color:#56B6C2;"> echo</span><span style="color:#98C379;"> confignode-</span><span style="color:#E06C75;">$i</span><span style="color:#ABB2BF;">; </span><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pod</span><span style="color:#98C379;"> confignode-</span><span style="color:#ABB2BF;">\${</span><span style="color:#E06C75;">i</span><span style="color:#ABB2BF;">} </span><span style="color:#D19A66;">-n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Node:&quot;</span><span style="color:#D19A66;"> -e</span><span style="color:#98C379;"> &quot;Path:&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>View the Detailed Information of the Corresponding Volume to Determine the Physical Directory Location:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> describe</span><span style="color:#98C379;"> pv</span><span style="color:#98C379;"> iotdb-pv-04</span><span style="color:#ABB2BF;"> | </span><span style="color:#61AFEF;">grep</span><span style="color:#98C379;"> &quot;Path:&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Example output:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Path:          /data/k8s-data/iotdb-pv-04</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Locate the system-info file in the corresponding directory on the corresponding node, use this system-info as the machine code to generate an activation code, and create a new file named license in the same directory, writing the activation code into this file.</li></ol><h2 id="_9-verify-iotdb" tabindex="-1"><a class="header-anchor" href="#_9-verify-iotdb"><span>9. Verify IoTDB</span></a></h2><h3 id="_9-1-check-the-status-of-pods-within-the-namespace" tabindex="-1"><a class="header-anchor" href="#_9-1-check-the-status-of-pods-within-the-namespace"><span>9.1 Check the Status of Pods within the Namespace</span></a></h3><p>View the IP, status, and other information of the pods in the iotdb-ns namespace to ensure they are all running normally.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Example output:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME           READY   STATUS    RESTARTS         AGE   IP             NODE   NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-0   1/1     Running   0                75m   10.20.187.14   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-1   1/1     Running   0                75m   10.20.191.75   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-2   1/1     Running   0                75m   10.20.187.16   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-0     1/1     Running   10 (5m54s ago)   75m   10.20.191.74   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-1     1/1     Running   10 (5m42s ago)   75m   10.20.187.15   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-2     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-2-check-the-port-mapping-within-the-namespace" tabindex="-1"><a class="header-anchor" href="#_9-2-check-the-port-mapping-within-the-namespace"><span>9.2 Check the Port Mapping within the Namespace</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> svc</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Example output:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME             TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-svc   NodePort       10.10.226.151   &lt;none&gt;        80:31026/TCP     7d8h</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-svc     NodePort       10.10.194.225   &lt;none&gt;        6667:31563/TCP   7d8h</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># jdbc-balancer    LoadBalancer   10.10.191.209   &lt;pending&gt;     6667:31895/TCP   7d8h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_9-3-start-the-cli-script-on-any-server-to-verify-the-iotdb-cluster-status" tabindex="-1"><a class="header-anchor" href="#_9-3-start-the-cli-script-on-any-server-to-verify-the-iotdb-cluster-status"><span>9.3 Start the CLI Script on Any Server to Verify the IoTDB Cluster Status</span></a></h3><p>Use the port of jdbc-balancer and the IP of any k8s node.</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.86</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span>
<span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.87</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span>
<span class="line"><span style="color:#61AFEF;">start-cli.sh</span><span style="color:#D19A66;"> -h</span><span style="color:#D19A66;"> 172.20.31.88</span><span style="color:#D19A66;"> -p</span><span style="color:#D19A66;"> 31895</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes02.png" alt="" style="width:70%;"><h2 id="_10-scaling" tabindex="-1"><a class="header-anchor" href="#_10-scaling"><span>10. Scaling</span></a></h2><h3 id="_10-1-add-new-pv" tabindex="-1"><a class="header-anchor" href="#_10-1-add-new-pv"><span>10.1 Add New PV</span></a></h3><p>Add a new PV; scaling is only possible with available PVs.</p><img src="https://alioss.timecho.com/docs/img/Kubernetes03.png" alt="" style="width:70%;"><p><strong>Note: DataNode cannot join the cluster after restart</strong></p><p><strong>Reason</strong>：The static storage hostPath mode is configured, and the script modifies the <code>iotdb-system.properties</code> file to set <code>dn_data_dirs</code> to <code>/iotdb6/iotdb_data,/iotdb7/iotdb_data</code>. However, the default storage path <code>/iotdb/data</code> is not mounted, leading to data loss upon restart.<br><strong>Solution</strong>：Mount the <code>/iotdb/data</code> directory as well, and ensure this setting is applied to both ConfigNode and DataNode to maintain data integrity and cluster stability.</p><h3 id="_10-2-scale-confignode" tabindex="-1"><a class="header-anchor" href="#_10-2-scale-confignode"><span>10.2 Scale ConfigNode</span></a></h3><p>Example: Scale from 3 ConfigNodes to 4 ConfigNodes</p><p>Modify the values.yaml file in iotdb-cluster-k8s/helm to change the number of ConfigNodes from 3 to 4.</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> upgrade</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> .</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><img src="https://alioss.timecho.com/docs/img/Kubernetes04.png" alt="" style="width:70%;"><h3 id="_10-3-scale-datanode" tabindex="-1"><a class="header-anchor" href="#_10-3-scale-datanode"><span>10.3 Scale DataNode</span></a></h3><p>Example: Scale from 3 DataNodes to 4 DataNodes</p><p>Modify the values.yaml file in iotdb-cluster-k8s/helm to change the number of DataNodes from 3 to 4.</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">helm</span><span style="color:#98C379;"> upgrade</span><span style="color:#98C379;"> iotdb</span><span style="color:#98C379;"> .</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_10-4-verify-iotdb-status" tabindex="-1"><a class="header-anchor" href="#_10-4-verify-iotdb-status"><span>10.4 Verify IoTDB Status</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">kubectl</span><span style="color:#98C379;"> get</span><span style="color:#98C379;"> pods</span><span style="color:#D19A66;"> -n</span><span style="color:#98C379;"> iotdb-ns</span><span style="color:#D19A66;"> -o</span><span style="color:#98C379;"> wide</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># NAME           READY   STATUS    RESTARTS         AGE   IP             NODE   NOMINATED NODE   READINESS GATES</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-0   1/1     Running   0                75m   10.20.187.14   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-1   1/1     Running   0                75m   10.20.191.75   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># confignode-2   1/1     Running   0                75m   10.20.187.16   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-0     1/1     Running   10 (5m54s ago)   75m   10.20.191.74   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-1     1/1     Running   10 (5m42s ago)   75m   10.20.187.15   a87    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-2     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># datanode-3     1/1     Running   10 (5m55s ago)   75m   10.20.191.76   a88    &lt;none&gt;           &lt;none&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,113)]))}const r=e(o,[["render",t],["__file","Kubernetes_apache.html.vue"]]),c=JSON.parse('{"path":"/UserGuide/latest/Ecosystem-Integration/Kubernetes_apache.html","title":"Kubernetes","lang":"en-US","frontmatter":{"description":"Kubernetes 1. Environment Preparation 1.1 Prepare a Kubernetes Cluster Ensure that you have an available Kubernetes cluster (minimum recommended version: Kubernetes 1.24) as the...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://iotdb.apache.org/zh/UserGuide/latest/Ecosystem-Integration/Kubernetes_apache.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/UserGuide/latest/Ecosystem-Integration/Kubernetes_apache.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:title","content":"Kubernetes"}],["meta",{"property":"og:description","content":"Kubernetes 1. Environment Preparation 1.1 Prepare a Kubernetes Cluster Ensure that you have an available Kubernetes cluster (minimum recommended version: Kubernetes 1.24) as the..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-12T13:55:54.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-12T13:55:54.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Kubernetes\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-01-12T13:55:54.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"1. Environment Preparation","slug":"_1-environment-preparation","link":"#_1-environment-preparation","children":[{"level":3,"title":"1.1 Prepare a Kubernetes Cluster","slug":"_1-1-prepare-a-kubernetes-cluster","link":"#_1-1-prepare-a-kubernetes-cluster","children":[]}]},{"level":2,"title":"2. Create Namespace","slug":"_2-create-namespace","link":"#_2-create-namespace","children":[{"level":3,"title":"2.1 Create Namespace","slug":"_2-1-create-namespace","link":"#_2-1-create-namespace","children":[]},{"level":3,"title":"2.2 View Namespace","slug":"_2-2-view-namespace","link":"#_2-2-view-namespace","children":[]}]},{"level":2,"title":"3. Create PersistentVolume (PV)","slug":"_3-create-persistentvolume-pv","link":"#_3-create-persistentvolume-pv","children":[{"level":3,"title":"3.1 Create PV Configuration File","slug":"_3-1-create-pv-configuration-file","link":"#_3-1-create-pv-configuration-file","children":[]},{"level":3,"title":"3.2 Apply PV Configuration","slug":"_3-2-apply-pv-configuration","link":"#_3-2-apply-pv-configuration","children":[]},{"level":3,"title":"3.3 View PV","slug":"_3-3-view-pv","link":"#_3-3-view-pv","children":[]},{"level":3,"title":"3.4 Manually Create Directories","slug":"_3-4-manually-create-directories","link":"#_3-4-manually-create-directories","children":[]}]},{"level":2,"title":"4. Install Helm","slug":"_4-install-helm","link":"#_4-install-helm","children":[]},{"level":2,"title":"5. Configure IoTDB Helm Chart","slug":"_5-configure-iotdb-helm-chart","link":"#_5-configure-iotdb-helm-chart","children":[{"level":3,"title":"5.1 Clone IoTDB Kubernetes Deployment Code","slug":"_5-1-clone-iotdb-kubernetes-deployment-code","link":"#_5-1-clone-iotdb-kubernetes-deployment-code","children":[]},{"level":3,"title":"5.2 Modify YAML Files","slug":"_5-2-modify-yaml-files","link":"#_5-2-modify-yaml-files","children":[]}]},{"level":2,"title":"6. Configure Private Repository Information or Pre-Pull Images","slug":"_6-configure-private-repository-information-or-pre-pull-images","link":"#_6-configure-private-repository-information-or-pre-pull-images","children":[{"level":3,"title":"6.1 [Option 1] Pull Image from Private Repository","slug":"_6-1-option-1-pull-image-from-private-repository","link":"#_6-1-option-1-pull-image-from-private-repository","children":[]},{"level":3,"title":"6.2 [Option 2] Import Image","slug":"_6-2-option-2-import-image","link":"#_6-2-option-2-import-image","children":[]}]},{"level":2,"title":"7. Install IoTDB","slug":"_7-install-iotdb","link":"#_7-install-iotdb","children":[{"level":3,"title":"7.1  Install IoTDB","slug":"_7-1-install-iotdb","link":"#_7-1-install-iotdb","children":[]},{"level":3,"title":"7.2 View Helm Installation List","slug":"_7-2-view-helm-installation-list","link":"#_7-2-view-helm-installation-list","children":[]},{"level":3,"title":"7.3 View Pods","slug":"_7-3-view-pods","link":"#_7-3-view-pods","children":[]},{"level":3,"title":"7.4 Troubleshooting","slug":"_7-4-troubleshooting","link":"#_7-4-troubleshooting","children":[]}]},{"level":2,"title":"8. Activate IoTDB","slug":"_8-activate-iotdb","link":"#_8-activate-iotdb","children":[{"level":3,"title":"8.1 Option 1: Activate Directly in the Pod (Quickest)","slug":"_8-1-option-1-activate-directly-in-the-pod-quickest","link":"#_8-1-option-1-activate-directly-in-the-pod-quickest","children":[]},{"level":3,"title":"8.2 Option 2: Activate Inside the ConfigNode Container","slug":"_8-2-option-2-activate-inside-the-confignode-container","link":"#_8-2-option-2-activate-inside-the-confignode-container","children":[]},{"level":3,"title":"Option 3: Manual Activation","slug":"option-3-manual-activation","link":"#option-3-manual-activation","children":[]}]},{"level":2,"title":"9.  Verify IoTDB","slug":"_9-verify-iotdb","link":"#_9-verify-iotdb","children":[{"level":3,"title":"9.1 Check the Status of Pods within the Namespace","slug":"_9-1-check-the-status-of-pods-within-the-namespace","link":"#_9-1-check-the-status-of-pods-within-the-namespace","children":[]},{"level":3,"title":"9.2 Check the Port Mapping within the Namespace","slug":"_9-2-check-the-port-mapping-within-the-namespace","link":"#_9-2-check-the-port-mapping-within-the-namespace","children":[]},{"level":3,"title":"9.3 Start the CLI Script on Any Server to Verify the IoTDB Cluster Status","slug":"_9-3-start-the-cli-script-on-any-server-to-verify-the-iotdb-cluster-status","link":"#_9-3-start-the-cli-script-on-any-server-to-verify-the-iotdb-cluster-status","children":[]}]},{"level":2,"title":"10. Scaling","slug":"_10-scaling","link":"#_10-scaling","children":[{"level":3,"title":"10.1  Add New PV","slug":"_10-1-add-new-pv","link":"#_10-1-add-new-pv","children":[]},{"level":3,"title":"10.2 Scale ConfigNode","slug":"_10-2-scale-confignode","link":"#_10-2-scale-confignode","children":[]},{"level":3,"title":"10.3 Scale DataNode","slug":"_10-3-scale-datanode","link":"#_10-3-scale-datanode","children":[]},{"level":3,"title":"10.4 Verify IoTDB Status","slug":"_10-4-verify-iotdb-status","link":"#_10-4-verify-iotdb-status","children":[]}]}],"git":{"createdTime":1736690154000,"updatedTime":1736690154000,"contributors":[{"name":"W1y1r","username":"W1y1r","email":"150988475+W1y1r@users.noreply.github.com","commits":1,"url":"https://github.com/W1y1r"}]},"readingTime":{"minutes":6.6,"words":1980},"filePathRelative":"UserGuide/latest/Ecosystem-Integration/Kubernetes_apache.md","localizedDate":"January 12, 2025","autoDesc":true}');export{r as comp,c as data};
