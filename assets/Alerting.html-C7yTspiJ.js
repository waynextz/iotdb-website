import{_ as p,c as o,b as l,d as a,e as n,a as r,f as t,r as i,o as c}from"./app-CBPT9zqK.js";const B={};function y(d,s){const e=i("RouteLink");return c(),o("div",null,[s[7]||(s[7]=l(`<h2 id="告警" tabindex="-1"><a class="header-anchor" href="#告警"><span>告警</span></a></h2><h3 id="概览" tabindex="-1"><a class="header-anchor" href="#概览"><span>概览</span></a></h3><p>IoTDB 告警功能预计支持两种模式：</p><ul><li><p>写入触发：用户写入原始数据到原始时间序列，每插入一条数据都会触发 <code>trigger</code> 的判断逻辑，<br> 若满足告警要求则发送告警到下游数据接收器，<br> 数据接收器再转发告警到外部终端。这种模式：</p><ul><li>适合需要即时监控每一条数据的场景。</li><li>由于触发器中的运算会影响数据写入性能，适合对原始数据写入性能不敏感的场景。</li></ul></li><li><p>持续查询：用户写入原始数据到原始时间序列，<br><code>ContinousQuery</code> 定时查询原始时间序列，将查询结果写入新的时间序列，<br> 每一次写入触发 <code>trigger</code> 的判断逻辑，<br> 若满足告警要求则发送告警到下游数据接收器，<br> 数据接收器再转发告警到外部终端。这种模式：</p><ul><li>适合需要定时查询数据在某一段时间内的情况的场景。</li><li>适合需要将原始数据降采样并持久化的场景。</li><li>由于定时查询几乎不影响原始时间序列的写入，适合对原始数据写入性能敏感的场景。</li></ul></li></ul><p>随着 <code>trigger</code> 模块和 <code>sink</code> 模块的引入，<br> 目前用户使用这两个模块，配合 <code>AlertManager</code> 可以实现写入触发模式的告警。</p><h3 id="部署-alertmanager" tabindex="-1"><a class="header-anchor" href="#部署-alertmanager"><span>部署 AlertManager</span></a></h3><h4 id="安装与运行" tabindex="-1"><a class="header-anchor" href="#安装与运行"><span>安装与运行</span></a></h4><h5 id="二进制文件" tabindex="-1"><a class="header-anchor" href="#二进制文件"><span>二进制文件</span></a></h5><p>预编译好的二进制文件可在 <a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">这里</a> 下载。</p><p>运行方法：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">./alertmanager</span><span style="color:#D19A66;"> --config.file=</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#D19A66;">your_file</span><span style="color:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="docker-镜像" tabindex="-1"><a class="header-anchor" href="#docker-镜像"><span>Docker 镜像</span></a></h5><p>可在 <a href="https://hub.docker.com/r/prom/alertmanager/" target="_blank" rel="noopener noreferrer">Quay.io</a><br> 或 <a href="https://quay.io/repository/prometheus/alertmanager" target="_blank" rel="noopener noreferrer">Docker Hub</a> 获得。</p><p>运行方法：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#61AFEF;">docker</span><span style="color:#98C379;"> run</span><span style="color:#D19A66;"> --name</span><span style="color:#98C379;"> alertmanager</span><span style="color:#D19A66;"> -d</span><span style="color:#D19A66;"> -p</span><span style="color:#98C379;"> 127.0.0.1:9093:9093</span><span style="color:#98C379;"> quay.io/prometheus/alertmanager</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="配置" tabindex="-1"><a class="header-anchor" href="#配置"><span>配置</span></a></h4><p>如下是一个示例，可以覆盖到大部分配置规则，详细的配置规则参见<br><a href="https://prometheus.io/docs/alerting/latest/configuration/" target="_blank" rel="noopener noreferrer">这里</a>。</p><p>示例：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># alertmanager.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">global</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # The smarthost and SMTP sender used for mail notifications.</span></span>
<span class="line"><span style="color:#E06C75;">  smtp_smarthost</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;localhost:25&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  smtp_from</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;alertmanager@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># The root route on which each incoming alert enters.</span></span>
<span class="line"><span style="color:#E06C75;">route</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # The root route must not have any matchers as it is the entry point for</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # all alerts. It needs to have a receiver configured so alerts that do not</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # match any of the sub-routes are sent to someone.</span></span>
<span class="line"><span style="color:#E06C75;">  receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-X-mails&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # The labels by which incoming alerts are grouped together. For example,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # multiple alerts coming in for cluster=A and alertname=LatencyHigh would</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # be batched into a single group.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # To aggregate by all possible labels use &#39;...&#39; as the sole label name.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # This effectively disables aggregation entirely, passing through all</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # alerts as-is. This is unlikely to be what you want, unless you have</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # a very low alert volume or your upstream notification system performs</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # its own grouping. Example: group_by: [...]</span></span>
<span class="line"><span style="color:#E06C75;">  group_by</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;alertname&#39;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&#39;cluster&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # When a new group of alerts is created by an incoming alert, wait at</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # least &#39;group_wait&#39; to send the initial notification.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # This way ensures that you get multiple alerts for the same group that start</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # firing shortly after another are batched together on the first</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # notification.</span></span>
<span class="line"><span style="color:#E06C75;">  group_wait</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">30s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # When the first notification was sent, wait &#39;group_interval&#39; to send a batch</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # of new alerts that started firing for that group.</span></span>
<span class="line"><span style="color:#E06C75;">  group_interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">5m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # If an alert has successfully been sent, wait &#39;repeat_interval&#39; to</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # resend them.</span></span>
<span class="line"><span style="color:#E06C75;">  repeat_interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">3h</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # All the above attributes are inherited by all child routes and can</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # overwritten on each.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # The child route trees.</span></span>
<span class="line"><span style="color:#E06C75;">  routes</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # This routes performs a regular expression match on alert labels to</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # catch alerts that are related to a list of services.</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">match_re</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      service</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">^(foo1|foo2|baz)$</span></span>
<span class="line"><span style="color:#E06C75;">    receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-X-mails</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # The service has a sub-route for critical alerts, any alerts</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # that do not match, i.e. severity != critical, fall-back to the</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # parent node and are sent to &#39;team-X-mails&#39;</span></span>
<span class="line"><span style="color:#E06C75;">    routes</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">critical</span></span>
<span class="line"><span style="color:#E06C75;">      receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-X-pager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      service</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">files</span></span>
<span class="line"><span style="color:#E06C75;">    receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-Y-mails</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    routes</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">critical</span></span>
<span class="line"><span style="color:#E06C75;">      receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-Y-pager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # This route handles all alerts coming from a database service. If there&#39;s</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # no team to handle it, it defaults to the DB team.</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      service</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-DB-pager</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">    # Also group alerts by affected database.</span></span>
<span class="line"><span style="color:#E06C75;">    group_by</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">alertname</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">cluster</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">database</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">    routes</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        owner</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-X</span></span>
<span class="line"><span style="color:#E06C75;">      receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-X-pager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#E06C75;">match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">        owner</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-Y</span></span>
<span class="line"><span style="color:#E06C75;">      receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">team-Y-pager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># Inhibition rules allow to mute a set of alerts given that another alert is</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># firing.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># We use this to mute any warning-level notifications if the same alert is</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;"># already critical.</span></span>
<span class="line"><span style="color:#E06C75;">inhibit_rules</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">source_match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;critical&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  target_match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">    severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;warning&#39;</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # Apply inhibition if the alertname is the same.</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  # CAUTION: </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #   If all label names listed in \`equal\` are missing </span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #   from both the source and target alerts,</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">  #   the inhibition rule will apply!</span></span>
<span class="line"><span style="color:#E06C75;">  equal</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;alertname&#39;</span><span style="color:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">receivers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-X-mails&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  email_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-X+alerts@example.org, team-Y+alerts@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-X-pager&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  email_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-X+alerts-critical@example.org&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  pagerduty_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">routing_key</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&lt;team-X-key&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-Y-mails&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  email_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-Y+alerts@example.org&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-Y-pager&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  pagerduty_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">routing_key</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&lt;team-Y-key&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">- </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;team-DB-pager&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  pagerduty_configs</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">routing_key</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&lt;team-DB-key&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在后面的示例中，我们采用的配置如下：</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#7F848E;font-style:italic;"># alertmanager.yml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">global</span><span style="color:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#E06C75;">  smtp_smarthost</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span></span>
<span class="line"><span style="color:#E06C75;">  smtp_from</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;">  smtp_auth_username</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;">  smtp_auth_password</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;">  smtp_require_tls</span><span style="color:#ABB2BF;">: </span><span style="color:#D19A66;">false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">route</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">  group_by</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;alertname&#39;</span><span style="color:#ABB2BF;">] </span></span>
<span class="line"><span style="color:#E06C75;">  group_wait</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">1m</span></span>
<span class="line"><span style="color:#E06C75;">  group_interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10m</span></span>
<span class="line"><span style="color:#E06C75;">  repeat_interval</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">10h</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"><span style="color:#E06C75;">  receiver</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;email&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">receivers</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">name</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;email&#39;</span></span>
<span class="line"><span style="color:#E06C75;">    email_configs</span><span style="color:#ABB2BF;">: </span></span>
<span class="line"><span style="color:#ABB2BF;">    - </span><span style="color:#E06C75;">to</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;&#39;</span><span style="color:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;">inhibit_rules</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;">  - </span><span style="color:#E06C75;">source_match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;critical&#39;</span></span>
<span class="line"><span style="color:#E06C75;">    target_match</span><span style="color:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;">      severity</span><span style="color:#ABB2BF;">: </span><span style="color:#98C379;">&#39;warning&#39;</span></span>
<span class="line"><span style="color:#E06C75;">    equal</span><span style="color:#ABB2BF;">: [</span><span style="color:#98C379;">&#39;alertname&#39;</span><span style="color:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="api" tabindex="-1"><a class="header-anchor" href="#api"><span>API</span></a></h4><p><code>AlertManager</code> API 分为 <code>v1</code> 和 <code>v2</code> 两个版本，当前 <code>AlertManager</code> API 版本为 <code>v2</code><br> （配置参见<br><a href="https://github.com/prometheus/alertmanager/blob/master/api/v2/openapi.yaml" target="_blank" rel="noopener noreferrer">api/v2/openapi.yaml</a>)。</p><p>默认配置的前缀为 <code>/api/v1</code> 或 <code>/api/v2</code>，<br> 发送告警的 endpoint 为 <code>/api/v1/alerts</code> 或 <code>/api/v2/alerts</code>。<br> 如果用户指定了 <code>--web.route-prefix</code>，<br> 例如 <code>--web.route-prefix=/alertmanager/</code>，<br> 那么前缀将会变为 <code>/alertmanager/api/v1</code> 或 <code>/alertmanager/api/v2</code>，<br> 发送告警的 endpoint 变为 <code>/alertmanager/api/v1/alerts</code><br> 或 <code>/alertmanager/api/v2/alerts</code>。</p><h3 id="创建-trigger" tabindex="-1"><a class="header-anchor" href="#创建-trigger"><span>创建 trigger</span></a></h3><h4 id="编写-trigger-类" tabindex="-1"><a class="header-anchor" href="#编写-trigger-类"><span>编写 trigger 类</span></a></h4>`,26)),a("p",null,[s[1]||(s[1]=n("用户通过自行创建 Java 类、编写钩子中的逻辑来定义一个触发器。")),s[2]||(s[2]=a("br",null,null,-1)),s[3]||(s[3]=n(" 具体配置流程以及 Sink 模块提供的 ")),s[4]||(s[4]=a("code",null,"AlertManagerSink",-1)),s[5]||(s[5]=n(" 相关工具类的使用方法参见 ")),r(e,{to:"/zh/UserGuide/V0.13.x/Process-Data/Triggers.html"},{default:t(()=>s[0]||(s[0]=[n("Triggers")])),_:1}),s[6]||(s[6]=n("。"))]),s[8]||(s[8]=l(`<p>下面的示例创建了 <code>org.apache.iotdb.trigger.AlertingExample</code> 类，<br> 其 <code>alertManagerHandler</code><br> 成员变量可发送告警至地址为 <code>http://127.0.0.1:9093/</code> 的 AlertManager 实例。</p><p>当 <code>value &gt; 100.0</code> 时，发送 <code>severity</code> 为 <code>critical</code> 的告警；<br> 当 <code>50.0 &lt; value &lt;= 100.0</code> 时，发送 <code>severity</code> 为 <code>warning</code> 的告警。</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">package</span><span style="color:#C678DD;"> org.apache.iotdb.trigger</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">/*</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">此处省略包的引入</span></span>
<span class="line"><span style="color:#7F848E;font-style:italic;">*/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">public</span><span style="color:#C678DD;"> class</span><span style="color:#E5C07B;"> AlertingExample</span><span style="color:#C678DD;"> implements</span><span style="color:#E5C07B;"> Trigger</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  private</span><span style="color:#C678DD;"> final</span><span style="color:#E5C07B;"> AlertManagerHandler</span><span style="color:#E06C75;"> alertManagerHandler </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> AlertManagerHandler</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  private</span><span style="color:#C678DD;"> final</span><span style="color:#E5C07B;"> AlertManagerConfiguration</span><span style="color:#E06C75;"> alertManagerConfiguration </span><span style="color:#56B6C2;">=</span></span>
<span class="line"><span style="color:#C678DD;">      new</span><span style="color:#61AFEF;"> AlertManagerConfiguration</span><span style="color:#E06C75;">(</span><span style="color:#98C379;">&quot;http://127.0.0.1:9093/api/v2/alerts&quot;</span><span style="color:#E06C75;">)</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  private</span><span style="color:#E5C07B;"> String</span><span style="color:#E06C75;"> alertname</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  private</span><span style="color:#C678DD;"> final</span><span style="color:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;"> String</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> labels </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">  private</span><span style="color:#C678DD;"> final</span><span style="color:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;">&lt;</span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">,</span><span style="color:#E5C07B;"> String</span><span style="color:#ABB2BF;">&gt;</span><span style="color:#E06C75;"> annotations </span><span style="color:#56B6C2;">=</span><span style="color:#C678DD;"> new</span><span style="color:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;">()</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> onCreate</span><span style="color:#ABB2BF;">(</span><span style="color:#E5C07B;">TriggerAttributes</span><span style="color:#E06C75;font-style:italic;"> attributes</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> Exception</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(alertManagerConfiguration);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">    alertname </span><span style="color:#56B6C2;">=</span><span style="color:#98C379;"> &quot;alert_test&quot;</span><span style="color:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;series&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;root.ln.wf01.wt01.temperature&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;severity&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;">    annotations</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;summary&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;high temperature&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">    annotations</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;description&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;{{.alertname}}: {{.series}} is {{.value}}&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> onDrop</span><span style="color:#ABB2BF;">()</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> IOException</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> onStart</span><span style="color:#ABB2BF;">()</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">open</span><span style="color:#ABB2BF;">(alertManagerConfiguration);</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> void</span><span style="color:#61AFEF;"> onStop</span><span style="color:#ABB2BF;">()</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> Exception</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;">    alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">close</span><span style="color:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#E5C07B;"> Double</span><span style="color:#61AFEF;"> fire</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">long</span><span style="color:#E06C75;font-style:italic;"> timestamp</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">Double</span><span style="color:#E06C75;font-style:italic;"> value</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> Exception</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    if</span><span style="color:#ABB2BF;"> (value </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 100.0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">      labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">valueOf</span><span style="color:#ABB2BF;">(value));</span></span>
<span class="line"><span style="color:#E5C07B;">      labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;severity&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;critical&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">      AlertManagerEvent</span><span style="color:#E06C75;"> alertManagerEvent</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> AlertManagerEvent</span><span style="color:#ABB2BF;">(alertname, labels, annotations);</span></span>
<span class="line"><span style="color:#E5C07B;">      alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">onEvent</span><span style="color:#ABB2BF;">(alertManagerEvent);</span></span>
<span class="line"><span style="color:#ABB2BF;">    } </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (value </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 50.0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">      labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">valueOf</span><span style="color:#ABB2BF;">(value));</span></span>
<span class="line"><span style="color:#E5C07B;">      labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;severity&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;warning&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">      AlertManagerEvent</span><span style="color:#E06C75;"> alertManagerEvent</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> AlertManagerEvent</span><span style="color:#ABB2BF;">(alertname, labels, annotations);</span></span>
<span class="line"><span style="color:#E5C07B;">      alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">onEvent</span><span style="color:#ABB2BF;">(alertManagerEvent);</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> value;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;">  @</span><span style="color:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;">  public</span><span style="color:#C678DD;"> double</span><span style="color:#61AFEF;">[] fire</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">long</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">timestamps</span><span style="color:#ABB2BF;">, </span><span style="color:#C678DD;">double</span><span style="color:#ABB2BF;">[] </span><span style="color:#E06C75;font-style:italic;">values</span><span style="color:#ABB2BF;">)</span><span style="color:#C678DD;"> throws</span><span style="color:#E5C07B;"> Exception</span><span style="color:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;">    for</span><span style="color:#ABB2BF;"> (</span><span style="color:#C678DD;">double</span><span style="color:#E06C75;"> value</span><span style="color:#C678DD;"> :</span><span style="color:#ABB2BF;"> values) {</span></span>
<span class="line"><span style="color:#C678DD;">      if</span><span style="color:#ABB2BF;"> (value </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 100.0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">        labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">valueOf</span><span style="color:#ABB2BF;">(value));</span></span>
<span class="line"><span style="color:#E5C07B;">        labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;severity&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;critical&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">        AlertManagerEvent</span><span style="color:#E06C75;"> alertManagerEvent</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> AlertManagerEvent</span><span style="color:#ABB2BF;">(alertname, labels, annotations);</span></span>
<span class="line"><span style="color:#E5C07B;">        alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">onEvent</span><span style="color:#ABB2BF;">(alertManagerEvent);</span></span>
<span class="line"><span style="color:#ABB2BF;">      } </span><span style="color:#C678DD;">else</span><span style="color:#C678DD;"> if</span><span style="color:#ABB2BF;"> (value </span><span style="color:#56B6C2;">&gt;</span><span style="color:#D19A66;"> 50.0</span><span style="color:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;">        labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;value&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#E5C07B;">String</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">valueOf</span><span style="color:#ABB2BF;">(value));</span></span>
<span class="line"><span style="color:#E5C07B;">        labels</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">put</span><span style="color:#ABB2BF;">(</span><span style="color:#98C379;">&quot;severity&quot;</span><span style="color:#ABB2BF;">, </span><span style="color:#98C379;">&quot;warning&quot;</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;">        AlertManagerEvent</span><span style="color:#E06C75;"> alertManagerEvent</span><span style="color:#56B6C2;"> =</span><span style="color:#C678DD;"> new</span><span style="color:#61AFEF;"> AlertManagerEvent</span><span style="color:#ABB2BF;">(alertname, labels, annotations);</span></span>
<span class="line"><span style="color:#E5C07B;">        alertManagerHandler</span><span style="color:#ABB2BF;">.</span><span style="color:#61AFEF;">onEvent</span><span style="color:#ABB2BF;">(alertManagerEvent);</span></span>
<span class="line"><span style="color:#ABB2BF;">      }</span></span>
<span class="line"><span style="color:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#C678DD;">    return</span><span style="color:#ABB2BF;"> values;</span></span>
<span class="line"><span style="color:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建-trigger-1" tabindex="-1"><a class="header-anchor" href="#创建-trigger-1"><span>创建 trigger</span></a></h4><p>如下的 sql 语句在 <code>root.ln.wf01.wt01.temperature</code><br> 时间序列上注册了名为 <code>root-ln-wf01-wt01-alert</code>、<br> 运行逻辑由 <code>org.apache.iotdb.trigger.AlertingExample</code><br> 类定义的触发器。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">  CREATE</span><span style="color:#ABB2BF;"> TRIGGER </span><span style="color:#98C379;">\`root-ln-wf01-wt01-alert\`</span></span>
<span class="line"><span style="color:#C678DD;">  AFTER</span><span style="color:#C678DD;"> INSERT</span></span>
<span class="line"><span style="color:#C678DD;">  ON</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">.temperature</span></span>
<span class="line"><span style="color:#C678DD;">  AS</span><span style="color:#98C379;"> &quot;org.apache.iotdb.trigger.AlertingExample&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="写入数据" tabindex="-1"><a class="header-anchor" href="#写入数据"><span>写入数据</span></a></h3><p>当我们完成 AlertManager 的部署和启动、Trigger 的创建，<br> 可以通过向时间序列写入数据来测试告警功能。</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#C678DD;">INSERT INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">, temperature) </span><span style="color:#C678DD;">VALUES</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">1</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">0</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">INSERT INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">, temperature) </span><span style="color:#C678DD;">VALUES</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">2</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">30</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">INSERT INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">, temperature) </span><span style="color:#C678DD;">VALUES</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">3</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">60</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">INSERT INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">, temperature) </span><span style="color:#C678DD;">VALUES</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">4</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">90</span><span style="color:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;">INSERT INTO</span><span style="color:#D19A66;"> root</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">ln</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wf01</span><span style="color:#ABB2BF;">.</span><span style="color:#D19A66;">wt01</span><span style="color:#ABB2BF;">(</span><span style="color:#C678DD;">timestamp</span><span style="color:#ABB2BF;">, temperature) </span><span style="color:#C678DD;">VALUES</span><span style="color:#ABB2BF;"> (</span><span style="color:#D19A66;">5</span><span style="color:#ABB2BF;">, </span><span style="color:#D19A66;">120</span><span style="color:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行完上述写入语句后，可以收到告警邮件。由于我们的 <code>AlertManager</code> 配置中设定 <code>severity</code> 为 <code>critical</code> 的告警<br> 会抑制 <code>severity</code> 为 <code>warning</code> 的告警，我们收到的告警邮件中只包含写入<br><code>(5, 120)</code> 后触发的告警。</p><img alt="alerting" src="https://alioss.timecho.com/docs/img/github/115957896-a9791080-a537-11eb-9962-541412bdcee6.png">`,11))])}const u=p(B,[["render",y],["__file","Alerting.html.vue"]]),m=JSON.parse('{"path":"/zh/UserGuide/V0.13.x/Process-Data/Alerting.html","title":"","lang":"zh-CN","frontmatter":{"description":"告警 概览 IoTDB 告警功能预计支持两种模式： 写入触发：用户写入原始数据到原始时间序列，每插入一条数据都会触发 trigger 的判断逻辑， 若满足告警要求则发送告警到下游数据接收器， 数据接收器再转发告警到外部终端。这种模式： 适合需要即时监控每一条数据的场景。 由于触发器中的运算会影响数据写入性能，适合对原始数据写入性能不敏感的场景。 持续查...","head":[["link",{"rel":"alternate","hreflang":"en-us","href":"https://iotdb.apache.org/UserGuide/V0.13.x/Process-Data/Alerting.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/zh/UserGuide/V0.13.x/Process-Data/Alerting.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:description","content":"告警 概览 IoTDB 告警功能预计支持两种模式： 写入触发：用户写入原始数据到原始时间序列，每插入一条数据都会触发 trigger 的判断逻辑， 若满足告警要求则发送告警到下游数据接收器， 数据接收器再转发告警到外部终端。这种模式： 适合需要即时监控每一条数据的场景。 由于触发器中的运算会影响数据写入性能，适合对原始数据写入性能不敏感的场景。 持续查..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2023-07-10T03:11:17.000Z"}],["meta",{"property":"article:modified_time","content":"2023-07-10T03:11:17.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-07-10T03:11:17.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"告警","slug":"告警","link":"#告警","children":[{"level":3,"title":"概览","slug":"概览","link":"#概览","children":[]},{"level":3,"title":"部署 AlertManager","slug":"部署-alertmanager","link":"#部署-alertmanager","children":[]},{"level":3,"title":"创建 trigger","slug":"创建-trigger","link":"#创建-trigger","children":[]},{"level":3,"title":"写入数据","slug":"写入数据","link":"#写入数据","children":[]}]}],"git":{"createdTime":1688958677000,"updatedTime":1688958677000,"contributors":[{"name":"CritasWang","username":"CritasWang","email":"critas@outlook.com","commits":1,"url":"https://github.com/CritasWang"}]},"readingTime":{"minutes":5.9,"words":1771},"filePathRelative":"zh/UserGuide/V0.13.x/Process-Data/Alerting.md","localizedDate":"2023年7月10日","autoDesc":true}');export{u as comp,m as data};
