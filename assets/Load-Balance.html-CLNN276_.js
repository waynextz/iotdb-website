import{_ as t,c as o,d as n,e as s,a as i,f as r,b as l,r as d,o as c}from"./app-BrzuM4xY.js";const p={};function u(m,e){const a=d("RouteLink");return c(),o("div",null,[e[3]||(e[3]=n("h2",{id:"load-balance",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#load-balance"},[n("span",null,"Load Balance")])],-1)),e[4]||(e[4]=n("p",null,"Region migration belongs to advanced operations and maintenance functions, which have certain operational costs. It is recommended to read the entire document before using this function. If you have any questions about the solution design, please contact the IoTDB team for technical support.",-1)),e[5]||(e[5]=n("h3",{id:"feature-introduction",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#feature-introduction"},[n("span",null,"Feature introduction")])],-1)),n("p",null,[e[1]||(e[1]=s("IoTDB is a distributed database, and the balanced distribution of data plays an important role in load balancing the disk space and write pressure of the cluster. Region is the basic unit for distributed storage of data in IoTDB cluster, and the specific concept can be seen in ")),i(a,{to:"/UserGuide/latest/Background-knowledge/Cluster-Concept.html"},{default:r(()=>e[0]||(e[0]=[s("region")])),_:1}),e[2]||(e[2]=s("。"))]),e[6]||(e[6]=l(`<p>Under normal operation of the cluster, IoTDB will automatically perform load balancing on data. However, in scenarios where a new DataNode node is added to the cluster or where the hard disk of the machine where the DataNode is located is damaged and data needs to be recovered, manual region migration can be used to finely adjust the cluster load and operations.</p><p>Here is a schematic diagram of the region migration process :</p><figure><img src="https://alioss.timecho.com/docs/img/region迁移示意图20241210.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="notes" tabindex="-1"><a class="header-anchor" href="#notes"><span>Notes</span></a></h3><ol><li>It is recommended to only use the Region Migration feature on IoTDB 1.3.3 and higher versions.</li><li>Region migration is only supported when the consensus protocol is IoTConsus or Ratis (in iotdb system. properties, the <code>schema_region_consensus_protocol_class</code> and<code>data_region_consensus_protocol_class</code>).</li><li>Region migration consumes system resources such as disk space and network bandwidth. It is recommended to perform the migration during periods of low business load.</li><li>Under ideal circumstances, Region migration does not affect user-side read or write operations. In special cases, Region migration may block writes. For detailed identification and handling of such situations, please refer to the user guide.</li></ol><h3 id="instructions-for-use" tabindex="-1"><a class="header-anchor" href="#instructions-for-use"><span>Instructions for use</span></a></h3><ul><li><p><strong>Grammar definition</strong> :</p><p>Submit an asynchronous task to migrate a region from one DataNode to another.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">  migrateRegion</span></span>
<span class="line"><span style="color:#ABB2BF;">      : MIGRATE REGION regionId</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">INTEGER_LITERAL </span><span style="color:#C678DD;">FROM</span><span style="color:#ABB2BF;"> fromId</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">INTEGER_LITERAL </span><span style="color:#C678DD;">TO</span><span style="color:#ABB2BF;"> toId</span><span style="color:#56B6C2;">=</span><span style="color:#ABB2BF;">INTEGER_LITERAL</span></span>
<span class="line"><span style="color:#ABB2BF;">      ;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Example</strong> :</p><p>Migrating region 1 from DataNode 2 to DataNode 3:</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span style="color:#ABB2BF;">  IoTDB</span><span style="color:#56B6C2;">&gt;</span><span style="color:#ABB2BF;"> migrate region </span><span style="color:#D19A66;">1</span><span style="color:#C678DD;"> from</span><span style="color:#D19A66;"> 2</span><span style="color:#C678DD;"> to</span><span style="color:#D19A66;"> 3</span></span>
<span class="line"><span style="color:#ABB2BF;">  Msg: The </span><span style="color:#C678DD;">statement</span><span style="color:#C678DD;"> is</span><span style="color:#ABB2BF;"> executed successfully.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>&quot;The statement is executed successfully&quot; only represents the successful submission of the region migration task, not the completion of execution. The execution status of the task can be viewed through the CLI command <code>show regions </code>.</p></li><li><p><strong>Related configuration</strong> :</p><ul><li>Migration speed control : modify <code>iotdb-system.properties </code>parameters <code>region_migration_speed_limit_bytes_per_second </code>control region migration speed.</li></ul></li><li><p><strong>Time cost estimation</strong> :</p><ul><li>If there are no concurrent writes during the migration process, the time consumption can be simply estimated by dividing the region data volume by the data transfer speed. For example, for a 1TB region, the hard disk internet bandwidth and speed limit parameters jointly determine that the data transfer speed is 100MB/s, so it takes about 3 hours to complete the migration.</li><li>If there are concurrent writes in the migration process, the time consumption will increase, and the specific time consumption depends on various factors such as write pressure and system resources. It can be simply estimated as <code>no concurrent write time × 1.5 </code>.</li></ul></li><li><p><strong>Migration progress observation</strong> : During the migration process, the state changes can be observed through the CLI command <code>show regions </code>. Taking the 2 replicas as an example, the state of the consensus group where the region is located will go through the following process:</p><ul><li>Before migration starts: <code>Running </code>, <code>Running </code>.</li><li>Expansion phase: <code>Running </code>, <code>Running </code>, <code>Adding </code>. Due to the large number of file transfers involved, it may take a long time. If using IoTConsensus, the specific file transfer progress can be searched in the DataNode log <code>[SNAPSHOT TRANSMISSION] </code>.</li><li>Stages: <code>Removing </code>, <code>Running </code>, <code>Running </code>.</li><li>Migration complete: <code>Running </code>, <code>Running </code>.</li></ul><p>Taking the expansion phase as an example, the result of <code>show regions</code> may be:</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>IoTDB&gt; show regions</span></span>
<span class="line"><span>+--------+------------+-------+--------+-------------+-----------+----------+----------+-------+---------------+--------+-----------------------+</span></span>
<span class="line"><span>|RegionId|        Type| Status|Database|SeriesSlotNum|TimeSlotNum|DataNodeId|RpcAddress|RpcPort|InternalAddress|    Role|             CreateTime|</span></span>
<span class="line"><span>+--------+------------+-------+--------+-------------+-----------+----------+----------+-------+---------------+--------+-----------------------+</span></span>
<span class="line"><span>|       0|SchemaRegion|Running| root.ln|            1|          0|         1|   0.0.0.0|   6668|      127.0.0.1|  Leader|2024-04-15T18:55:17.691|</span></span>
<span class="line"><span>|       0|SchemaRegion|Running| root.ln|            1|          0|         2|   0.0.0.0|   6668|      127.0.0.1|  Leader|2024-04-15T18:55:17.691|</span></span>
<span class="line"><span>|       0|SchemaRegion|Running| root.ln|            1|          0|         3|   0.0.0.0|   6668|      127.0.0.1|  Leader|2024-04-15T18:55:17.691|</span></span>
<span class="line"><span>|       1|  DataRegion|Running| root.ln|            1|          1|         1|   0.0.0.0|   6667|      127.0.0.1|  Leader|2024-04-15T18:55:19.457|</span></span>
<span class="line"><span>|       1|  DataRegion|Running| root.ln|            1|          1|         2|   0.0.0.0|   6668|      127.0.0.1|Follower|2024-04-15T18:55:19.457|</span></span>
<span class="line"><span>|       1|  DataRegion| Adding| root.ln|            1|          1|         3|   0.0.0.0|   6668|      127.0.0.1|Follower|2024-04-15T18:55:19.457|</span></span>
<span class="line"><span>+--------+------------+-------+--------+-------------+-----------+----------+----------+-------+---------------+--------+-----------------------+</span></span>
<span class="line"><span>Total line number = 3</span></span>
<span class="line"><span>It costs 0.003s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Block Write</strong>:<br> The region migration in IoTConsensus does not directly block writes. However, since the process requires suspending the cleanup of WAL files, if the accumulated WAL files exceed the threshold defined by wal_throttle_threshold_in_byte, the current DataNode will pause writing until the WAL files fall below the threshold.</p><p>If a write error occurs during the migration due to the WAL exceeding the threshold (e.g., an error message like “The write is rejected because the wal directory size has reached the threshold”), you can increase the wal_throttle_threshold_in_byte value to 500GB or more to allow continued writing. Use the following SQL statement:</p><div class="language-plain line-numbers-mode" data-highlighter="shiki" data-ext="plain" data-title="plain" style="background-color:#282c34;color:#abb2bf;"><pre class="shiki one-dark-pro vp-code"><code><span class="line"><span>  IoTDB&gt; set configuration &quot;wal_throttle_threshold_in_byte&quot;=&quot;536870912000&quot; </span></span>
<span class="line"><span>  Msg: The statement is executed successfully.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul>`,7))])}const g=t(p,[["render",u],["__file","Load-Balance.html.vue"]]),b=JSON.parse('{"path":"/UserGuide/latest/User-Manual/Load-Balance.html","title":"","lang":"en-US","frontmatter":{"description":"Load Balance Region migration belongs to advanced operations and maintenance functions, which have certain operational costs. It is recommended to read the entire document befor...","head":[["link",{"rel":"alternate","hreflang":"zh-cn","href":"https://iotdb.apache.org/zh/UserGuide/latest/User-Manual/Load-Balance.html"}],["meta",{"property":"og:url","content":"https://iotdb.apache.org/UserGuide/latest/User-Manual/Load-Balance.html"}],["meta",{"property":"og:site_name","content":"IoTDB Website"}],["meta",{"property":"og:description","content":"Load Balance Region migration belongs to advanced operations and maintenance functions, which have certain operational costs. It is recommended to read the entire document befor..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://alioss.timecho.com/docs/img/region%E8%BF%81%E7%A7%BB%E7%A4%BA%E6%84%8F%E5%9B%BE20241210.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:locale:alternate","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-13T04:01:11.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-13T04:01:11.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"\\",\\"image\\":[\\"https://alioss.timecho.com/docs/img/region%E8%BF%81%E7%A7%BB%E7%A4%BA%E6%84%8F%E5%9B%BE20241210.png\\"],\\"dateModified\\":\\"2025-01-13T04:01:11.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"Load Balance","slug":"load-balance","link":"#load-balance","children":[{"level":3,"title":"Feature introduction","slug":"feature-introduction","link":"#feature-introduction","children":[]},{"level":3,"title":"Notes","slug":"notes","link":"#notes","children":[]},{"level":3,"title":"Instructions for use","slug":"instructions-for-use","link":"#instructions-for-use","children":[]}]}],"git":{"createdTime":1736690542000,"updatedTime":1736740871000,"contributors":[{"name":"Li Yu Heng","username":"Li Yu Heng","email":"liyuheng55555@126.com","commits":1,"url":"https://github.com/Li Yu Heng"},{"name":"W1y1r","username":"W1y1r","email":"150988475+W1y1r@users.noreply.github.com","commits":1,"url":"https://github.com/W1y1r"}]},"readingTime":{"minutes":3.21,"words":963},"filePathRelative":"UserGuide/latest/User-Manual/Load-Balance.md","localizedDate":"January 12, 2025","autoDesc":true}');export{g as comp,b as data};
